{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"action-buttons\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_date_picker = _resolveComponent(\"el-date-picker\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  return _openBlock(), _createBlock(_component_el_row, {\n    class: \"common-container\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_row, {\n      class: \"filter-row\"\n    }, {\n      default: _withCtx(() => [_cache[2] || (_cache[2] = _createElementVNode(\"span\", {\n        class: \"top-bar\"\n      }, \"借阅时间\", -1)), _createVNode(_component_el_date_picker, {\n        size: \"small\",\n        style: {\n          \"width\": \"240px\"\n        },\n        modelValue: $setup.searchTime,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.searchTime = $event),\n        type: \"daterange\",\n        \"value-format\": \"yyyy-MM-dd\",\n        \"range-separator\": \"-\",\n        \"start-placeholder\": \"起始日期\",\n        \"end-placeholder\": \"结束日期\"\n      }, null, 8, [\"modelValue\"]), _createVNode(_component_el_button, {\n        size: \"small\",\n        class: \"query-btn no-icon\",\n        type: \"primary\",\n        onClick: $setup.handleFilter\n      }, {\n        default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\"立即查询\", -1)])),\n        _: 1,\n        __: [1]\n      }, 8, [\"onClick\"])]),\n      _: 1,\n      __: [2]\n    }), _createVNode(_component_el_row, {\n      class: \"table-container\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table, {\n        data: $setup.tableData,\n        class: \"custom-table\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_table_column, {\n          prop: \"bookName\",\n          label: \"书籍名\"\n        }), _createVNode(_component_el_table_column, {\n          prop: \"userName\",\n          width: \"98\",\n          label: \"订阅者\"\n        }), _createVNode(_component_el_table_column, {\n          prop: \"deadlineNum\",\n          width: \"88\",\n          label: \"馆藏数\"\n        }), _createVNode(_component_el_table_column, {\n          prop: \"isReturn\",\n          width: \"130\",\n          label: \"是否归还\"\n        }, {\n          default: _withCtx(scope => [_createVNode(_component_el_tag, {\n            type: scope.row.isReturn ? 'success' : 'warning',\n            size: \"small\"\n          }, {\n            default: _withCtx(() => [_createTextVNode(_toDisplayString(scope.row.isReturn ? '已归还' : '未归还'), 1)]),\n            _: 2\n          }, 1032, [\"type\"])]),\n          _: 1\n        }), _createVNode(_component_el_table_column, {\n          prop: \"returnTime\",\n          width: \"168\",\n          label: \"归还时间\"\n        }), _createVNode(_component_el_table_column, {\n          prop: \"createTime\",\n          width: \"168\",\n          label: \"借阅时间\"\n        }), _createVNode(_component_el_table_column, {\n          label: \"操作\",\n          width: \"100\",\n          align: \"center\"\n        }, {\n          default: _withCtx(scope => [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_el_tag, {\n            type: \"danger\",\n            size: \"small\",\n            onClick: $event => $setup.handleDelete(scope.row),\n            class: \"action-tag delete-tag\"\n          }, {\n            default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\" 删除 \", -1)])),\n            _: 2,\n            __: [3]\n          }, 1032, [\"onClick\"])])]),\n          _: 1\n        })]),\n        _: 1\n      }, 8, [\"data\"]), _createVNode(_component_el_pagination, {\n        style: {\n          \"margin\": \"20px 0\",\n          \"float\": \"right\"\n        },\n        onSizeChange: $setup.handleSizeChange,\n        onCurrentChange: $setup.handleCurrentChange,\n        \"current-page\": $setup.currentPage,\n        \"page-sizes\": [5, 7],\n        \"page-size\": $setup.pageSize,\n        layout: \"total, sizes, prev, pager, next, jumper\",\n        total: $setup.totalItems\n      }, null, 8, [\"onSizeChange\", \"onCurrentChange\", \"current-page\", \"page-size\", \"total\"])]),\n      _: 1\n    })]),\n    _: 1\n  });\n}","map":{"version":3,"names":["class","_createBlock","_component_el_row","_createVNode","_createElementVNode","_component_el_date_picker","size","style","$setup","searchTime","$event","type","_component_el_button","onClick","handleFilter","_cache","_component_el_table","data","tableData","_component_el_table_column","prop","label","width","default","_withCtx","scope","_component_el_tag","row","isReturn","align","_hoisted_1","handleDelete","_component_el_pagination","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange","currentPage","pageSize","layout","total","totalItems"],"sources":["E:\\code\\IntelliJ_IDEAProjects\\LibrarySystem\\libraryNetView\\src\\views\\admin\\BookOrderHistoryManage.vue"],"sourcesContent":["<template>\n    <el-row class=\"common-container\">\n        <el-row class=\"filter-row\">\n            <span class=\"top-bar\">借阅时间</span>\n            <el-date-picker size=\"small\" style=\"width: 240px;\" v-model=\"searchTime\" type=\"daterange\"\n                value-format=\"yyyy-MM-dd\"\n                range-separator=\"-\" start-placeholder=\"起始日期\" end-placeholder=\"结束日期\">\n            </el-date-picker>\n            <el-button size=\"small\" class=\"query-btn no-icon\" type=\"primary\"\n                @click=\"handleFilter\">立即查询</el-button>\n        </el-row>\n        <el-row class=\"table-container\">\n            <el-table :data=\"tableData\" class=\"custom-table\">\n                <el-table-column prop=\"bookName\" label=\"书籍名\"></el-table-column>\n                <el-table-column prop=\"userName\" width=\"98\" label=\"订阅者\"></el-table-column>\n                <el-table-column prop=\"deadlineNum\" width=\"88\" label=\"馆藏数\"></el-table-column>\n                <el-table-column prop=\"isReturn\" width=\"130\" label=\"是否归还\">\n                    <template #default=\"scope\">\n                        <el-tag :type=\"scope.row.isReturn ? 'success' : 'warning'\" size=\"small\">\n                            {{ scope.row.isReturn ? '已归还' : '未归还' }}\n                        </el-tag>\n                    </template>\n                </el-table-column>\n                <el-table-column prop=\"returnTime\" width=\"168\" label=\"归还时间\"></el-table-column>\n                <el-table-column prop=\"createTime\" width=\"168\" label=\"借阅时间\"></el-table-column>\n                <el-table-column label=\"操作\" width=\"100\" align=\"center\">\n                    <template #default=\"scope\">\n                        <div class=\"action-buttons\">\n                            <el-tag type=\"danger\" size=\"small\" @click.native=\"handleDelete(scope.row)\" class=\"action-tag delete-tag\">\n                                删除\n                            </el-tag>\n                        </div>\n                    </template>\n                </el-table-column>\n            </el-table>\n            <el-pagination style=\"margin: 20px 0;float: right;\" @size-change=\"handleSizeChange\"\n                @current-change=\"handleCurrentChange\" :current-page=\"currentPage\" :page-sizes=\"[5, 7]\"\n                :page-size=\"pageSize\" layout=\"total, sizes, prev, pager, next, jumper\"\n                :total=\"totalItems\"></el-pagination>\n        </el-row>\n    </el-row>\n</template>\n\n<script>\nimport { ref, reactive, onMounted, getCurrentInstance } from 'vue'\n\nexport default {\n    setup() {\n        const { proxy } = getCurrentInstance()\n        \n        // 响应式数据\n        const data = reactive({})\n        const currentPage = ref(1)\n        const cover = ref(null)\n        const pageSize = ref(7)\n        const totalItems = ref(0)\n        const tableData = ref([])\n        const selectedRows = ref([])\n        const bookOrderHistoryQueryDto = reactive({}) // 搜索条件\n        const options = ref([])\n        const bookshelfOptions = ref([])\n        const searchTime = ref([])\n\n        // 方法定义\n        // 多选框选中\n        const handleSelectionChange = (selection) => {\n            selectedRows.value = selection\n        }\n\n        // 批量删除数据\n        const batchDelete = async () => {\n            if (!selectedRows.value.length) {\n                proxy.$message(`未选中任何数据`)\n                return\n            }\n            const confirmed = await proxy.$swalConfirm({\n                title: '删除借阅记录数据',\n                text: `删除后不可恢复，是否继续？`,\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonText: '确认删除',\n                cancelButtonText: '取消',\n                confirmButtonColor: '#f56c6c',\n                cancelButtonColor: '#909399',\n                customClass: {\n                    popup: 'custom-delete-popup',\n                    confirmButton: 'custom-delete-confirm-button',\n                    cancelButton: 'custom-delete-cancel-button',\n                    title: 'custom-delete-title',\n                    content: 'custom-delete-content',\n                    icon: 'custom-delete-icon'\n                },\n                buttonsStyling: true,\n                iconColor: '#f56c6c',\n                backdrop: `rgba(0,0,0,0.4)`,\n                heightAuto: false,\n                padding: '2em'\n            })\n            \n            if (confirmed) {\n                try {\n                    let ids = selectedRows.value.map(entity => entity.id)\n                    const response = await proxy.$axios.post(`bookOrderHistory/batchDelete`, ids)\n                    if (response.data.code === 200) {\n                        proxy.$swal.fire({\n                            title: '删除成功',\n                            text: response.data.msg,\n                            icon: 'success',\n                            showConfirmButton: false,\n                            timer: 2000,\n                        })\n                        fetchFreshData()\n                        return\n                    }\n                } catch (e) {\n                    proxy.$swal.fire({\n                        title: '错误提示',\n                        text: e,\n                        icon: 'error',\n                        showConfirmButton: false,\n                        timer: 2000,\n                    })\n                    console.error(`借阅历史删除异常：`, e)\n                }\n            }\n        }\n\n        const resetQueryCondition = () => {\n            searchTime.value = []\n            Object.keys(bookOrderHistoryQueryDto).forEach(key => {\n                delete bookOrderHistoryQueryDto[key]\n            })\n            fetchFreshData()\n        }\n\n        const closeDialog = () => {\n            dialogOperation.value = false\n        }\n\n        const clearFormData = () => {\n            Object.keys(data).forEach(key => {\n                delete data[key]\n            })\n            cover.value = null\n        }\n\n        const fetchFreshData = async () => {\n            try {\n                tableData.value = []\n                let startTime = null\n                let endTime = null\n                if (searchTime.value != null && searchTime.value.length === 2) {\n                    startTime = `${searchTime.value[0]}T00:00:00`\n                    endTime = `${searchTime.value[1]}T23:59:59`\n                }\n                // 请求参数\n                const params = {\n                    current: currentPage.value,\n                    size: pageSize.value,\n                    startTime: startTime,\n                    endTime: endTime,\n                    ...bookOrderHistoryQueryDto\n                }\n                const response = await proxy.$axios.post('bookOrderHistory/query', params)\n                const { data: responseData } = response\n                tableData.value = responseData.data\n                totalItems.value = responseData.total\n            } catch (error) {\n                console.error('查询借阅记录信息异常:', error)\n            }\n        }\n\n        const add = () => {\n            dialogOperation.value = true\n        }\n\n        const handleFilter = () => {\n            currentPage.value = 1\n            fetchFreshData()\n        }\n\n        const handleFilterClear = () => {\n            handleFilter()\n        }\n\n        const handleSizeChange = (val) => {\n            pageSize.value = val\n            currentPage.value = 1\n            fetchFreshData()\n        }\n\n        const handleCurrentChange = (val) => {\n            currentPage.value = val\n            fetchFreshData()\n        }\n\n        const messagePush = (row) => {\n            Object.assign(data, { ...row })\n        }\n\n        const handleEdit = (row) => {\n            dialogOperation.value = true\n            isOperation.value = true\n            Object.assign(data, { ...row })\n            cover.value = row.cover\n        }\n\n        const handleDelete = (row) => {\n            selectedRows.value = []\n            selectedRows.value.push(row)\n            batchDelete()\n        }\n\n        // 生命周期\n        onMounted(() => {\n            fetchFreshData()\n        })\n\n        return {\n            data,\n            currentPage,\n            cover,\n            pageSize,\n            totalItems,\n            tableData,\n            selectedRows,\n            bookOrderHistoryQueryDto,\n            options,\n            bookshelfOptions,\n            searchTime,\n            handleSelectionChange,\n            batchDelete,\n            resetQueryCondition,\n            closeDialog,\n            clearFormData,\n            fetchFreshData,\n            add,\n            handleFilter,\n            handleFilterClear,\n            handleSizeChange,\n            handleCurrentChange,\n            messagePush,\n            handleEdit,\n            handleDelete\n        }\n    }\n}\n</script>\n<style scoped lang=\"scss\">\n.common-container {\n    background-color: #FFFFFF;\n    padding: 20px 0;\n    border-radius: 16px;\n    width: 100%;\n    box-sizing: border-box;\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.03);\n}\n\n.filter-row {\n    display: flex;\n    align-items: center;\n    padding: 10px 16px;\n    margin-bottom: 5px;\n}\n\n.table-container {\n    margin: 10px 16px;\n    border-top: none;\n}\n\n.top-bar {\n    color: #606266;\n    font-size: 14px;\n    margin-right: 8px;\n    line-height: 32px;\n    font-weight: 500;\n}\n\n.query-btn {\n    margin-left: 10px;\n    background-color: #3a8ee6;\n    color: #ffffff;\n    border: none;\n    font-weight: 500;\n    box-shadow: 0 2px 6px rgba(58, 142, 230, 0.3);\n}\n\n/* 添加表格样式 */\n.custom-table {\n    border-radius: 8px;\n    overflow: hidden;\n    margin-bottom: 20px;\n    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);\n    border: none;\n    \n    :deep(.el-table__header-wrapper) {\n        th {\n        background-color: #f5f7fa;\n        color: #606266;\n        font-weight: 600;\n        padding: 12px 0;\n        }\n    }\n\n    :deep(.el-table__body-wrapper) {\n        .el-table__row {\n        transition: all 0.3s;\n        \n        &:hover {\n            background-color: #f0f9ff !important;\n        }\n        \n        td {\n            padding: 10px 0;\n            vertical-align: middle;\n            height: 40px;\n            line-height: 20px;\n            border-bottom: 1px solid #ebeef5;\n            }\n        }\n    }\n\n    :deep(.el-table__empty-block) {\n        min-height: 60px;\n    }\n\n    :deep(.el-table__header), \n    :deep(.el-table__body) {\n        border: none;\n    }\n    \n    &::before, \n    &::after,\n    :deep(.el-table--border::after), \n    :deep(.el-table--group::after) {\n        display: none;\n    }\n}\n\n.action-buttons {\n    display: flex;\n    justify-content: center;\n    flex-wrap: nowrap;\n}\n\n.action-tag {\n    cursor: pointer;\n    transition: all 0.2s;\n    margin: 0 4px;\n    \n    &:hover {\n        opacity: 0.8;\n        transform: scale(1.05);\n    }\n    \n    &.delete-tag {\n        background-color: #fef0f0;\n        color: #F56C6C;\n        border-color: #fde2e2;\n    }\n}\n\n/* 分页样式美化 */\n:deep(.el-pagination) {\n    .el-pagination__total {\n        font-weight: 500;\n    }\n    \n    .el-pagination__sizes {\n        .el-input .el-input__inner {\n            border-radius: 4px;\n            transition: all 0.3s;\n            \n            &:hover, &:focus {\n                border-color: #409EFF;\n            }\n        }\n    }\n    \n    .el-pager li {\n        border-radius: 4px;\n        transition: all 0.3s;\n        \n        &:hover {\n            color: #409EFF;\n        }\n        \n        &.active {\n            background-color: #409EFF;\n            color: #fff;\n        }\n    }\n    \n    .btn-prev, .btn-next {\n        border-radius: 4px;\n        \n        &:hover {\n            color: #409EFF;\n        }\n    }\n}\n\n/* 隐藏按钮图标 */\n.no-icon {\n    :deep(i) {\n        display: none !important;\n    }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}