{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, onMounted, getCurrentInstance } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { Plus, InfoFilled, CircleCheck, Warning, Check } from '@element-plus/icons-vue';\nexport default {\n  name: \"Self\",\n  components: {\n    Plus,\n    InfoFilled,\n    CircleCheck,\n    Warning,\n    Check\n  },\n  setup() {\n    const {\n      proxy\n    } = getCurrentInstance();\n    const router = useRouter();\n\n    // 响应式数据\n    const userInfo = reactive({});\n    const userAvatar = ref('');\n    const loading = ref(false);\n    const userForm = ref(null);\n    const rules = reactive({\n      userName: [{\n        required: true,\n        message: '请输入昵称',\n        trigger: 'blur'\n      }, {\n        min: 2,\n        max: 20,\n        message: '长度在 2 到 20 个字符',\n        trigger: 'blur'\n      }],\n      userEmail: [{\n        required: true,\n        message: '请输入邮箱地址',\n        trigger: 'blur'\n      }, {\n        type: 'email',\n        message: '请输入正确的邮箱地址',\n        trigger: 'blur'\n      }]\n    });\n\n    // 方法\n    // 提交个人信息修改\n    const postInfo = async () => {\n      userForm.value.validate(async valid => {\n        if (valid) {\n          loading.value = true;\n          try {\n            const {\n              userName,\n              userEmail\n            } = userInfo;\n            const userUpdateDTO = {\n              userAvatar: userAvatar.value,\n              userName,\n              userEmail\n            };\n            const {\n              data\n            } = await proxy.$axios.put('/user/update', userUpdateDTO);\n            proxy.$notify({\n              position: 'top-right',\n              duration: 2000,\n              title: '个人信息',\n              message: data.code === 200 ? '修改成功' : '修改失败',\n              type: data.code === 200 ? 'success' : 'error'\n            });\n            // 更新数据\n            if (data.code === 200) {\n              auth();\n            }\n          } catch (error) {\n            proxy.$notify({\n              title: '提交失败',\n              message: error.message || '网络错误',\n              type: 'error'\n            });\n          } finally {\n            loading.value = false;\n          }\n        }\n      });\n    };\n\n    // 头像上传\n    const handleAvatarSuccess = (res, file) => {\n      proxy.$notify({\n        duration: 1500,\n        title: '头像上传',\n        message: res.code === 200 ? '上传成功' : '上传失败',\n        type: res.code === 200 ? 'success' : 'error'\n      });\n      // 上传成功则更新用户头像\n      if (res.code === 200) {\n        userAvatar.value = res.data;\n      }\n    };\n\n    // Token 检验 ,取得用户信息\n    const auth = async () => {\n      try {\n        const {\n          data\n        } = await proxy.$axios.get('/user/auth');\n        if (data.code !== 200) {\n          // Token校验异常\n          router.push('/');\n        } else {\n          Object.assign(userInfo, data.data);\n          userAvatar.value = data.data.userAvatar;\n        }\n      } catch (error) {\n        proxy.$notify({\n          title: '获取用户信息失败',\n          message: error.message || '请检查网络连接',\n          type: 'error'\n        });\n      }\n    };\n\n    // 生命周期\n    onMounted(() => {\n      auth();\n    });\n    return {\n      userInfo,\n      userAvatar,\n      loading,\n      userForm,\n      rules,\n      postInfo,\n      handleAvatarSuccess,\n      auth\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","getCurrentInstance","useRouter","Plus","InfoFilled","CircleCheck","Warning","Check","name","components","setup","proxy","router","userInfo","userAvatar","loading","userForm","rules","userName","required","message","trigger","min","max","userEmail","type","postInfo","value","validate","valid","userUpdateDTO","data","$axios","put","$notify","position","duration","title","code","auth","error","handleAvatarSuccess","res","file","get","push","Object","assign"],"sources":["E:\\code\\IntelliJ_IDEAProjects\\LibrarySystem\\libraryNetView\\src\\views\\user\\Self.vue"],"sourcesContent":["<template>\n    <div class=\"profile-container\">\n        <el-form :model=\"userInfo\" ref=\"userForm\" label-position=\"top\" :rules=\"rules\">            <!-- 头像 -->            <el-form-item label=\"头像\" prop=\"userAvatar\">                <el-upload \n                    class=\"avatar-uploader\" \n                    action=\"http://localhost:2025/api/library-system-api/v1.0/file/upload\" \n                    :show-file-list=\"false\"\n                    :on-success=\"handleAvatarSuccess\">\n                    <div class=\"avatar-container\">\n                        <img v-if=\"userAvatar\" :src=\"userAvatar\" class=\"avatar-image\">\n                        <el-icon v-else class=\"avatar-uploader-icon\"><Plus /></el-icon>\n                    </div>\n                </el-upload>\n            </el-form-item>\n            \n            <!-- 昵称 -->\n            <el-form-item label=\"昵称\" prop=\"userName\">\n                <el-input \n                    v-model=\"userInfo.userName\" \n                    placeholder=\"请输入昵称\" \n                    maxlength=\"20\"\n                    show-word-limit>\n                </el-input>\n            </el-form-item>            <!-- 邮箱 -->\n            <el-form-item label=\"邮箱\" prop=\"userEmail\">\n                <el-input \n                    v-model=\"userInfo.userEmail\" \n                    placeholder=\"请输入邮箱\"\n                    maxlength=\"50\"\n                    show-word-limit>\n                </el-input>\n            </el-form-item>\n            \n            <!-- 账号状态信息 -->\n            <el-card class=\"status-card\">\n                <div class=\"status-section\">\n                    <div class=\"status-header\">\n                        <span>账号状态</span>\n                        <el-tooltip effect=\"dark\" content=\"一经封号，不可登录，不可使用系统功能\" placement=\"top\">\n                            <el-icon><InfoFilled /></el-icon>\n                        </el-tooltip>\n                    </div>\n                    <div class=\"status-value\">\n                        <span v-if=\"!userInfo.isLogin\" class=\"status-normal\">\n                            <el-icon><CircleCheck /></el-icon> 正常\n                        </span>\n                        <span v-else class=\"status-banned\">\n                            <el-icon><Warning /></el-icon> 已被封禁\n                        </span>\n                    </div>\n                </div>\n                \n                <el-divider></el-divider>\n                \n                <div class=\"status-section\">\n                    <div class=\"status-header\">\n                        <span>留言状态</span>\n                        <el-tooltip effect=\"dark\" content=\"禁言后，互动功能受限\" placement=\"top\">\n                            <el-icon><InfoFilled /></el-icon>\n                        </el-tooltip>\n                    </div>\n                    <div class=\"status-value\">\n                        <span v-if=\"!userInfo.isWord\" class=\"status-normal\">\n                            <el-icon><CircleCheck /></el-icon> 正常\n                        </span>\n                        <span v-else class=\"status-banned\">\n                            <el-icon><Warning /></el-icon> 已被禁言\n                        </span>\n                    </div>\n                </div>\n            </el-card>\n            \n            <!-- 提交按钮 -->\n            <el-form-item>\n                <button class=\"save-button\" @click=\"postInfo\" :disabled=\"loading\">\n                    <el-icon><Check /></el-icon>\n                    <span>{{ loading ? '保存中...' : '保存修改' }}</span>\n                    <span class=\"button-loader\" v-if=\"loading\"></span>\n                </button>\n            </el-form-item>\n        </el-form>\n    </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted, getCurrentInstance } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { Plus, InfoFilled, CircleCheck, Warning, Check } from '@element-plus/icons-vue'\n\nexport default {\n    name: \"Self\",\n    components: {\n        Plus,\n        InfoFilled,\n        CircleCheck,\n        Warning,\n        Check\n    },\n    setup() {\n        const { proxy } = getCurrentInstance()\n        const router = useRouter()\n        \n        // 响应式数据\n        const userInfo = reactive({})\n        const userAvatar = ref('')\n        const loading = ref(false)\n        const userForm = ref(null)\n        const rules = reactive({\n            userName: [\n                { required: true, message: '请输入昵称', trigger: 'blur' },\n                { min: 2, max: 20, message: '长度在 2 到 20 个字符', trigger: 'blur' }\n            ],\n            userEmail: [\n                { required: true, message: '请输入邮箱地址', trigger: 'blur' },\n                { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }\n            ]\n        })\n\n        // 方法\n        // 提交个人信息修改\n        const postInfo = async () => {\n            userForm.value.validate(async (valid) => {\n                if (valid) {\n                    loading.value = true;\n                    try {\n                        const { userName, userEmail } = userInfo;\n                        const userUpdateDTO = {\n                            userAvatar: userAvatar.value,\n                            userName,\n                            userEmail\n                        }\n                        const { data } = await proxy.$axios.put('/user/update', userUpdateDTO);\n                        proxy.$notify({\n                            position: 'top-right',\n                            duration: 2000,\n                            title: '个人信息',\n                            message: data.code === 200 ? '修改成功' : '修改失败',\n                            type: data.code === 200 ? 'success' : 'error'\n                        });\n                        // 更新数据\n                        if (data.code === 200) {\n                            auth();\n                        }\n                    } catch (error) {\n                        proxy.$notify({\n                            title: '提交失败',\n                            message: error.message || '网络错误',\n                            type: 'error'\n                        });\n                    } finally {\n                        loading.value = false;\n                    }\n                }\n            });\n        }\n\n        // 头像上传\n        const handleAvatarSuccess = (res, file) => {\n            proxy.$notify({\n                duration: 1500,\n                title: '头像上传',\n                message: res.code === 200 ? '上传成功' : '上传失败',\n                type: res.code === 200 ? 'success' : 'error'\n            });\n            // 上传成功则更新用户头像\n            if (res.code === 200) {\n                userAvatar.value = res.data;\n            }\n        }\n\n        // Token 检验 ,取得用户信息\n        const auth = async () => {\n            try {\n                const { data } = await proxy.$axios.get('/user/auth');\n                if (data.code !== 200) { // Token校验异常\n                    router.push('/');\n                } else {\n                    Object.assign(userInfo, data.data);\n                    userAvatar.value = data.data.userAvatar;\n                }\n            } catch (error) {\n                proxy.$notify({\n                    title: '获取用户信息失败',\n                    message: error.message || '请检查网络连接',\n                    type: 'error'\n                });\n            }\n        }\n\n        // 生命周期\n        onMounted(() => {\n            auth();\n        })\n\n        return {\n            userInfo,\n            userAvatar,\n            loading,\n            userForm,\n            rules,\n            postInfo,\n            handleAvatarSuccess,\n            auth\n        }\n    }\n};\n</script>\n\n<style scoped lang=\"scss\">\n.profile-container {\n    padding: 20px;\n    max-width: 600px;\n    margin: 0 auto;      .avatar-uploader {        border: 1px dashed #d9d9d9;\n        border-radius: 16px; /* 更大的圆角 */\n        cursor: pointer;\n        position: relative;\n        overflow: hidden;\n        width: 120px;\n        height: 120px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        box-sizing: border-box;\n        background-color: #f5f7fa;\n          &:hover {\n            border-color: #ff5722;\n            background-color: #fafafa;        }\n        \n        .avatar-container {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n            .avatar-image {\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n            display: block;\n            margin: 0;\n            padding: 0;\n            border: none;\n            border-radius: 0; /* 确保图片没有圆角 */\n            -webkit-mask-image: none !important; /* 移除可能的遮罩 */\n            mask-image: none !important;\n            /* 添加一些额外的样式来确保图片不会被裁剪为圆形 */\n            background-size: cover;\n            background-position: center;\n            clip-path: none !important;\n            transform: none !important;\n            shape-outside: none !important;\n        }.avatar-uploader-icon {\n            font-size: 28px;\n            color: #8c939d;\n            width: 120px;\n            height: 120px;\n            line-height: 120px;\n            text-align: center;\n        }\n    }\n    \n    .status-card {\n        margin-bottom: 20px;\n        border-radius: 8px;\n        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);\n        \n        .status-section {\n            padding: 10px 0;\n            \n            .status-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-size: 15px;\n                font-weight: 600;\n                margin-bottom: 10px;\n                \n                i {\n                    color: #909399;\n                    cursor: help;\n                }\n            }\n            \n            .status-value {\n                font-size: 14px;\n                \n                .status-normal {\n                    color: #67c23a;\n                    display: flex;\n                    align-items: center;\n                    gap: 5px;\n                }\n                \n                .status-banned {\n                    color: #f56c6c;\n                    display: flex;\n                    align-items: center;\n                    gap: 5px;\n                }\n            }\n        }\n    }\n      ::v-deep .el-form-item__label {\n        line-height: 1.5;\n        padding-bottom: 8px;\n        font-size: 15px;\n        font-weight: 500;\n    }\n      ::v-deep .el-input__inner {\n        border-radius: 8px;\n    }\n    \n    ::v-deep .el-form-item {\n        margin-bottom: 25px;\n    }\n    \n    ::v-deep .el-button {\n        border-radius: 8px;\n        padding: 12px 20px;\n    }      ::v-deep .el-upload {\n        width: 100%;\n        height: 100%;\n        display: block;\n        border-radius: 16px;\n        overflow: hidden;\n        \n        /* 确保图片不会被裁剪为圆形 */\n        &:before, &:after {\n            display: none !important;\n        }\n        \n        /* 消除可能的蒙版效果 */\n        -webkit-mask-image: none !important;\n        mask-image: none !important;\n        \n        .el-upload-dragger {\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n            border: none;\n        }\n    }\n}\n\n.save-button {\n    background: linear-gradient(45deg, #ff7043, #ff5722);\n    border: none;\n    font-size: 13px;\n    padding: 8px 18px;\n    border-radius: 30px;\n    box-shadow: 0 2px 8px rgba(255, 87, 34, 0.2);\n    transition: all 0.3s ease;\n    color: white;\n    height: auto;\n    line-height: 1.5;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n    outline: none;\n    \n    &:before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));\n        border-radius: 30px;\n    }\n    \n    i {\n        font-size: 14px;\n    }\n    \n    &:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 5px 15px rgba(255, 87, 34, 0.35);\n        background: linear-gradient(45deg, #ff8a65, #ff7043);\n    }\n    \n    &:active {\n        transform: translateY(0);\n        box-shadow: 0 2px 8px rgba(255, 87, 34, 0.2);\n    }\n    \n    &:disabled {\n        opacity: 0.7;\n        cursor: not-allowed;\n        transform: none;\n    }\n    \n    .button-loader {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 16px;\n        height: 16px;\n        border: 2px solid rgba(255, 255, 255, 0.3);\n        border-radius: 50%;\n        border-top-color: white;\n        animation: spin 0.8s linear infinite;\n    }\n}\n\n@keyframes spin {\n    to {\n        transform: translate(-50%, -50%) rotate(360deg);\n    }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}