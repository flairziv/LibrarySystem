{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, vModelText as _vModelText, withKeys as _withKeys, createElementVNode as _createElementVNode, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"operation-log-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"word-search\"\n};\nconst _hoisted_3 = {\n  class: \"item\"\n};\nconst _hoisted_4 = {\n  class: \"content-wrapper\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"pagination-wrapper\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Search = _resolveComponent(\"Search\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_Delete = _resolveComponent(\"Delete\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.tableData.length !== 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_icon, null, {\n    default: _withCtx(() => [_createVNode(_component_Search)]),\n    _: 1\n  }), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    placeholder: \"搜索操作内容\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.userOperationLogQueryDto.content = $event),\n    onKeyup: _cache[1] || (_cache[1] = _withKeys((...args) => $setup.fetchFreshData && $setup.fetchFreshData(...args), [\"enter\"]))\n  }, null, 544), [[_vModelText, $setup.userOperationLogQueryDto.content]]), _createElementVNode(\"span\", {\n    class: \"search-text\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $setup.fetchFreshData && $setup.fetchFreshData(...args))\n  }, \"搜索\")])])) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_4, [$setup.tableData.length === 0 ? (_openBlock(), _createBlock(_component_el_empty, {\n    key: 0,\n    description: \"暂无操作日志\",\n    \"image-size\": 200\n  })) : (_openBlock(), _createBlock(_component_el_card, {\n    key: 1,\n    class: \"log-card\"\n  }, {\n    default: _withCtx(() => [_cache[4] || (_cache[4] = _createElementVNode(\"div\", {\n      class: \"card-header\"\n    }, [_createElementVNode(\"span\", {\n      class: \"card-title\"\n    }, \"操作日志记录\")], -1)), _createVNode(_component_el_table, {\n      data: $setup.tableData,\n      style: {\n        \"width\": \"100%\"\n      },\n      border: \"\",\n      stripe: \"\",\n      \"highlight-current-row\": \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"content\",\n        label: \"操作内容\",\n        \"min-width\": \"300\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"createTime\",\n        label: \"操作时间\",\n        width: \"180\"\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"120\",\n        align: \"center\"\n      }, {\n        default: _withCtx(scope => [_createVNode(_component_el_button, {\n          type: \"danger\",\n          size: \"small\",\n          circle: \"\",\n          onClick: $event => $setup.handleDelete(scope.row)\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_component_Delete)]),\n            _: 1\n          })]),\n          _: 2\n        }, 1032, [\"onClick\"])]),\n        _: 1\n      })]),\n      _: 1\n    }, 8, [\"data\"]), $setup.tableData.length !== 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createVNode(_component_el_pagination, {\n      onSizeChange: $setup.handleSizeChange,\n      onCurrentChange: $setup.handleCurrentChange,\n      \"current-page\": $setup.current,\n      \"onUpdate:currentPage\": _cache[3] || (_cache[3] = $event => $setup.current = $event),\n      \"page-size\": $setup.size,\n      \"page-sizes\": [10, 20, 50, 100],\n      layout: \"total, sizes, prev, pager, next, jumper\",\n      total: $setup.totalCount\n    }, null, 8, [\"onSizeChange\", \"onCurrentChange\", \"current-page\", \"page-size\", \"total\"])])) : _createCommentVNode(\"\", true)]),\n    _: 1,\n    __: [4]\n  }))])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$setup","tableData","length","_hoisted_2","_createElementVNode","_hoisted_3","_createVNode","_component_el_icon","_component_Search","type","placeholder","userOperationLogQueryDto","content","$event","onKeyup","_cache","_withKeys","args","fetchFreshData","onClick","_hoisted_4","_createBlock","_component_el_empty","description","_component_el_card","_component_el_table","data","style","border","stripe","_component_el_table_column","prop","label","width","align","default","_withCtx","scope","_component_el_button","size","circle","handleDelete","row","_component_Delete","_hoisted_5","_component_el_pagination","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange","current","layout","total","totalCount"],"sources":["E:\\code\\IntelliJ_IDEAProjects\\LibrarySystem\\libraryNetView\\src\\views\\user\\UserOperationLog.vue"],"sourcesContent":["<template>\n    <div class=\"operation-log-container\">\n        <!-- 条件搜索 -->\n        <div class=\"word-search\" v-if=\"tableData.length !== 0\">\n            <div class=\"item\">\n                    <el-icon>\n                        <Search />\n                    </el-icon>\n                    <input type=\"text\" placeholder=\"搜索操作内容\" v-model=\"userOperationLogQueryDto.content\" @keyup.enter=\"fetchFreshData\">\n                    <span class=\"search-text\" @click=\"fetchFreshData\">搜索</span>\n            </div>\n        </div>\n\n        <!-- 数据展示区域 -->\n        <div class=\"content-wrapper\">\n            <el-empty \n                v-if=\"tableData.length === 0\" \n                description=\"暂无操作日志\" \n                :image-size=\"200\">\n            </el-empty>\n            \n            <el-card v-else class=\"log-card\">\n                <div class=\"card-header\">\n                    <span class=\"card-title\">操作日志记录</span>\n                </div>\n                <el-table \n                    :data=\"tableData\" \n                    style=\"width: 100%\" \n                    border \n                    stripe\n                    highlight-current-row>\n                    <el-table-column prop=\"content\" label=\"操作内容\" min-width=\"300\"></el-table-column>\n                    <el-table-column prop=\"createTime\" label=\"操作时间\" width=\"180\"></el-table-column>\n                    <el-table-column label=\"操作\" width=\"120\" align=\"center\">\n                        <template #default=\"scope\">\n                            <el-button \n                                type=\"danger\" \n                                size=\"small\" \n                                circle\n                                @click=\"handleDelete(scope.row)\">\n                                <el-icon>\n                                    <Delete />\n                                </el-icon>\n                            </el-button>\n                        </template>\n                    </el-table-column>\n                </el-table>\n                \n                <!-- 分页器 -->\n                <div class=\"pagination-wrapper\" v-if=\"tableData.length !== 0\">\n                    <el-pagination\n                        @size-change=\"handleSizeChange\"\n                        @current-change=\"handleCurrentChange\"\n                        v-model:current-page=\"current\"\n                        :page-size=\"size\"\n                        :page-sizes=\"[10, 20, 50, 100]\"\n                        layout=\"total, sizes, prev, pager, next, jumper\"\n                    :total=\"totalCount\">\n                </el-pagination>\n            </div>\n            </el-card>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted, getCurrentInstance } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { Search, Delete } from '@element-plus/icons-vue';\nimport request from \"@/utils/request.js\";\nimport UserNavigation from '@/components/UserNavigation.vue';\n\nexport default {\n    components: {\n        UserNavigation,\n        Search,\n        Delete\n    },\n    setup() {\n        const { proxy } = getCurrentInstance();\n        const router = useRouter();\n        const route = useRoute();\n\n        // 响应式数据\n        const selfPath = ref({ name: '个人中心', path: '/mySelf' });\n        const userRoutes = ref([]);\n        const nowRoute = ref('操作日志');\n        const userInfo = reactive({\n            id: null,\n            url: '',\n            name: '',\n            role: null,\n            email: ''\n        });\n        const flag = ref(false);\n        const data = ref({});\n        const current = ref(1);\n        const cover = ref(null);\n        const size = ref(10);\n        const totalCount = ref(0);\n        const dialogOperation = ref(false);\n        const isOperation = ref(false);\n        const tableData = ref([]);\n        const selectedRows = ref([]);\n        const userOperationLogQueryDto = reactive({\n            current: 1,\n            size: 10\n        });\n        const options = ref([]);\n        const bookshelfOptions = ref([]);\n        const bookOrderHistorys = ref([]);\n        const searchTime = ref([]);\n\n        // 方法\n        const toggleSidebar = () => {\n            flag.value = !flag.value;\n            sessionStorage.setItem('flag', flag.value);\n        };\n\n        const refreshPage = () => {\n            const currentRoute = route;\n            router.replace('/refresh');\n            proxy.$nextTick(() => {\n                router.replace(currentRoute.fullPath);\n            });\n        };\n\n        const routerClick = (routeItem) => {\n            if (route.path !== routeItem.path) {\n                router.push(routeItem.path);\n            }\n        };\n\n        const menuOperationHistory = () => {\n            flag.value = sessionStorage.getItem('flag') === 'true';\n        };\n\n        // Token检验\n        const tokenCheckLoad = async () => {\n            try {\n                const res = await request.get('user/auth');\n                // 错误处理\n                if (res.data.code === 400) {\n                    proxy.$message.error(res.data.msg);\n                    router.push('/login');\n                    return;\n                }\n                // 用户信息赋值\n                const { id, userAvatar: url, userName: name, userRole: role, userEmail: email } = res.data.data;\n                Object.assign(userInfo, { id, url, name, role, email });\n                sessionStorage.setItem('userInfo', JSON.stringify(userInfo));\n                sessionStorage.setItem('userId', userInfo.id);\n            } catch (error) {\n                console.error('获取用户认证信息时发生错误:', error);\n                proxy.$message.error('认证信息加载失败，请重试！');\n            }\n        };\n\n        const fetchFreshData = async () => {\n            try {\n                const response = await proxy.$axios.post('/userOperationLog/queryUser', userOperationLogQueryDto);\n                const { data } = response;\n                tableData.value = data.data;\n                totalCount.value = data.total;\n            } catch (error) {\n                console.error('系统日志信息异常:', error);\n            }\n        };\n\n        const handleSizeChange = (newSize) => {\n            userOperationLogQueryDto.current = 1;\n            userOperationLogQueryDto.size = newSize;\n            size.value = newSize;\n            fetchFreshData();\n        };\n\n        const handleCurrentChange = (newCurrent) => {\n            userOperationLogQueryDto.current = newCurrent;\n            current.value = newCurrent;\n            fetchFreshData();\n        };\n\n        const handleDelete = (row) => {\n            batchDelete(row);\n        };\n\n        // 批量删除数据\n        const batchDelete = async (log) => {\n            const confirmed = await proxy.$swalConfirm({\n                title: '删除操作日志',\n                text: `操作不可恢复，是否继续？`,\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonText: '确认',\n                cancelButtonText: '取消',\n                confirmButtonColor: '#ff5722',\n                cancelButtonColor: '#909399'\n            });\n            if (confirmed) {\n                try {\n                    let ids = [log.id];\n                    const response = await proxy.$axios.post(`/userOperationLog/batchDelete`, ids);\n                    if (response.data.code === 200) {\n                        proxy.$notify({\n                            duration: 1000,\n                            title: '日志删除',\n                            message: '删除成功',\n                            type: 'success'\n                        });\n                        fetchFreshData();\n                    }\n                } catch (error) {\n                    proxy.$notify({\n                        title: '日志删除',\n                        message: error.message || '删除失败',\n                        type: 'error'\n                    });\n                    console.error(`删除异常：`, error);\n                }\n            }\n        };\n\n        onMounted(() => {\n            let menus = router.options.routes.filter(route => route.path == '/user')[0];\n            userRoutes.value = menus.children;\n            fetchFreshData();\n            tokenCheckLoad();\n            menuOperationHistory();\n        });\n\n        return {\n            selfPath,\n            userRoutes,\n            nowRoute,\n            userInfo,\n            flag,\n            data,\n            current,\n            cover,\n            size,\n            totalCount,\n            dialogOperation,\n            isOperation,\n            tableData,\n            selectedRows,\n            userOperationLogQueryDto,\n            options,\n            bookshelfOptions,\n            bookOrderHistorys,\n            searchTime,\n            toggleSidebar,\n            refreshPage,\n            routerClick,\n            menuOperationHistory,\n            tokenCheckLoad,\n            fetchFreshData,\n            handleSizeChange,\n            handleCurrentChange,\n            handleDelete,\n            batchDelete\n        };\n    }\n};\n</script>\n\n<style scoped lang=\"scss\">\n.operation-log-container {\n    width: 100%;\n    padding: 10px 20px 20px 20px;\n    box-sizing: border-box;\n    background-color: transparent;\n}\n\n.word-search {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 15px;\n    margin-top: 0;\n    \n    .item {\n        padding: 10px 20px;\n        width: 500px;\n                background-color: white;\n                border-radius: 40px;\n        display: flex;\n        justify-content: space-between;\n    align-items: center;\n                box-sizing: border-box;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n                border: 1px solid #eee;\n                transition: all 0.3s ease;\n                \n                &:hover, &:focus-within {\n                    box-shadow: 0 6px 16px rgba(255, 87, 34, 0.12);\n                    border-color: rgba(255, 87, 34, 0.2);\n                }\n                \n                input {\n                    flex: 1;\n                    border: none;\n                    background-color: transparent;\n                    outline: none;\n                    font-size: 16px;\n                    color: #333;\n                    margin: 0 15px;\n                    height: 24px;\n                }\n\n        i {\n            font-size: 18px;\n            color: #ff5722;\n        }\n                \n                .search-text {\n                    display: inline-block;\n                    padding: 6px 16px;\n                    border-radius: 20px;\n                    background-color: #ff5722;\n                    color: white;\n                    font-size: 14px;\n                    cursor: pointer;\n                    transition: all 0.3s ease;\n                    text-align: center;\n                    \n                    &:hover {\n                        background-color: #f4511e;\n                        transform: translateY(-1px);\n                }\n            }\n        }\n}\n\n    .content-wrapper {\n        background-color: transparent;\n    min-height: 300px;\n    display: flex;\n    justify-content: center;\n        align-items: flex-start;\n        \n        .log-card {\n            width: 100%;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n            border-radius: 12px;\n            overflow: hidden;\n            transition: all 0.3s;\n            \n            &:hover {\n                box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);\n                transform: translateY(-2px);\n            }\n            \n            .card-header {\n                padding: 16px 20px;\n                border-bottom: 1px solid #ebeef5;\n                margin-bottom: 12px;\n                \n                .card-title {\n                    font-size: 18px;\n                    font-weight: 600;\n                    color: #303133;\n                    position: relative;\n                    padding-left: 12px;\n                    \n                    &:before {\n                        content: '';\n                        position: absolute;\n                        left: 0;\n                        top: 50%;\n                        transform: translateY(-50%);\n                        width: 4px;\n                        height: 18px;\n                        background: #ff5722;\n                        border-radius: 2px;\n                    }\n                }\n            }\n            \n            :deep(.el-card__body) {\n                padding: 0 20px 20px;\n            }\n            \n            :deep(.el-table) {\n                border-radius: 8px;\n                overflow: hidden;\n                margin-bottom: 16px;\n                \n                th {\n                    background-color: #f5f7fa;\n                    color: #606266;\n                    font-weight: 600;\n                    padding: 14px 0;\n                }\n                \n                td {\n                    padding: 12px 0;\n                }\n                \n                .el-table__row {\n                    transition: all 0.2s;\n                    \n                    &:hover {\n                        background-color: rgba(255, 87, 34, 0.05) !important;\n                    }\n                }\n            }\n            \n            :deep(.el-table--border), \n            :deep(.el-table--group) {\n                border-radius: 8px;\n                border: 1px solid #ebeef5;\n            }\n\n            :deep(.el-table__row td:last-child) {\n                .el-button {\n                    transition: all 0.3s;\n                    \n                    &:hover {\n                        transform: scale(1.1);\n                        box-shadow: 0 2px 8px rgba(245, 108, 108, 0.4);\n                    }\n                }\n            }\n        }\n    }\n    \n    .pagination-wrapper {\n        display: flex;\n        justify-content: center;\n    margin-top: 20px;\n\n        :deep(.el-pagination) {\n            padding: 8px 16px;\n            background: #fff;\n            border-radius: 8px;\n            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);\n            \n            .el-pagination__sizes .el-input .el-input__inner {\n                border-radius: 6px;\n            }\n            \n            button, .btn-prev, .btn-next {\n                border-radius: 6px;\n                transition: all 0.2s;\n                \n                &:hover {\n                    background-color: rgba(255, 87, 34, 0.1);\n        }\n            }\n            \n            .el-pager li {\n                border-radius: 6px;\n                transition: all 0.2s;\n                \n                &:hover:not(.active) {\n                    background-color: rgba(255, 87, 34, 0.1);\n        }\n                \n                &.active {\n                    background-color: #ff5722;\n                    color: #fff;\n                    font-weight: bold;\n                }\n            }\n        }\n    }\n    \n    .el-empty {\n        margin: 100px 0;\n        transition: all 0.3s;\n\n        :deep(.el-empty__image) {\n            opacity: 0.8;\n        }\n\n        :deep(.el-empty__description) {\n            color: #909399;\n            font-size: 16px;\n    }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}