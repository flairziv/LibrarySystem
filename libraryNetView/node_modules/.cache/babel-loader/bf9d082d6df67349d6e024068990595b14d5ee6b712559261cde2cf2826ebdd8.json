{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createBlock as _createBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"book-rss-history-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"word-search\"\n};\nconst _hoisted_3 = {\n  class: \"item\"\n};\nconst _hoisted_4 = {\n  key: 2,\n  class: \"book-rss-container\"\n};\nconst _hoisted_5 = {\n  class: \"book-rss-table\"\n};\nconst _hoisted_6 = {\n  class: \"action-buttons\"\n};\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = {\n  key: 3,\n  class: \"pager\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Search = _resolveComponent(\"Search\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.tableData.length !== 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_icon, null, {\n    default: _withCtx(() => [_createVNode(_component_Search)]),\n    _: 1\n  }), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    placeholder: \"书籍ID\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.bookRssHistoryQueryDto.bookId = $event)\n  }, null, 512), [[_vModelText, $setup.bookRssHistoryQueryDto.bookId]]), _createElementVNode(\"span\", {\n    class: \"search-text\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $setup.fetchFreshData && $setup.fetchFreshData(...args))\n  }, \"搜索\")])])) : _createCommentVNode(\"\", true), $setup.tableData.length === 0 ? (_openBlock(), _createBlock(_component_el_row, {\n    key: 1\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_empty, {\n      description: \"暂无订阅书籍\"\n    })]),\n    _: 1\n  })) : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_cache[3] || (_cache[3] = _createStaticVNode(\"<div class=\\\"save-book header\\\" data-v-1287d018><div class=\\\"title\\\" data-v-1287d018>书籍名</div><div class=\\\"title\\\" data-v-1287d018>作者</div><div class=\\\"title\\\" data-v-1287d018>馆藏数</div><div class=\\\"title\\\" data-v-1287d018>书籍所在</div><div class=\\\"title\\\" data-v-1287d018>功能操作</div></div>\", 1)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.tableData, (save, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      class: \"save-book\",\n      key: index\n    }, [_createElementVNode(\"div\", null, _toDisplayString(save.bookName), 1), _createElementVNode(\"div\", null, _toDisplayString(save.author), 1), _createElementVNode(\"div\", null, _toDisplayString(save.num), 1), _createElementVNode(\"div\", null, _toDisplayString($setup.parseLocation(save)), 1), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"span\", {\n      class: \"action-btn cancel\",\n      onClick: $event => $setup.handleDelete(save)\n    }, \"取消订阅\", 8, _hoisted_7)])]);\n  }), 128))])])), $setup.tableData.length !== 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [_createElementVNode(\"div\", null, [_createVNode(_component_el_pagination, {\n    onSizeChange: $setup.handleSizeChange,\n    onCurrentChange: $setup.handleCurrentChange,\n    \"current-page\": $setup.current,\n    \"onUpdate:currentPage\": _cache[2] || (_cache[2] = $event => $setup.current = $event),\n    \"page-size\": $setup.size,\n    layout: \"total, prev, pager, next\",\n    total: $setup.totalCount\n  }, null, 8, [\"onSizeChange\", \"onCurrentChange\", \"current-page\", \"page-size\", \"total\"])])])) : _createCommentVNode(\"\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$setup","tableData","length","_hoisted_2","_createElementVNode","_hoisted_3","_createVNode","_component_el_icon","_component_Search","type","placeholder","bookRssHistoryQueryDto","bookId","$event","onClick","_cache","args","fetchFreshData","_createBlock","_component_el_row","key","_component_el_empty","description","_hoisted_4","_hoisted_5","_Fragment","_renderList","save","index","_toDisplayString","bookName","author","num","parseLocation","_hoisted_6","handleDelete","_hoisted_7","_hoisted_8","_component_el_pagination","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange","current","size","layout","total","totalCount"],"sources":["E:\\code\\IntelliJ_IDEAProjects\\LibrarySystem\\libraryNetView\\src\\views\\user\\BookRssHistory.vue"],"sourcesContent":["<template>\n    <div class=\"book-rss-history-container\">\n        <div class=\"word-search\" v-if=\"tableData.length !== 0\">\n            <div class=\"item\">\n                <el-icon><Search /></el-icon>\n                <input type=\"text\" placeholder=\"书籍ID\" v-model=\"bookRssHistoryQueryDto.bookId\">\n                <span class=\"search-text\" @click=\"fetchFreshData\">搜索</span>\n            </div>\n        </div>\n        <el-row v-if=\"tableData.length === 0\">\n            <el-empty description=\"暂无订阅书籍\"></el-empty>\n        </el-row>\n        <div v-else class=\"book-rss-container\">\n            <div class=\"book-rss-table\">\n                <div class=\"save-book header\">\n                    <div class=\"title\">书籍名</div>\n                    <div class=\"title\">作者</div>\n                    <div class=\"title\">馆藏数</div>\n                    <div class=\"title\">书籍所在</div>\n                    <div class=\"title\">功能操作</div>\n                </div>\n                <div class=\"save-book\" v-for=\"(save, index) in tableData\" :key=\"index\">\n                    <div>\n                        {{ save.bookName }}\n                    </div>\n                    <div>\n                        {{ save.author }}\n                    </div>\n                    <div>\n                        {{ save.num }}\n                    </div>\n                    <div>\n                        {{ parseLocation(save) }}\n                    </div>\n                    <div class=\"action-buttons\">\n                        <span class=\"action-btn cancel\" @click=\"handleDelete(save)\">取消订阅</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"pager\" v-if=\"tableData.length !== 0\">\n            <div>\n                <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\"\n                    v-model:current-page=\"current\" :page-size=\"size\" layout=\"total, prev, pager, next\"\n                    :total=\"totalCount\">\n                </el-pagination>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted, getCurrentInstance } from 'vue'\nimport { Search } from '@element-plus/icons-vue'\n\nexport default {\n    components: {\n        Search\n    },\n    setup() {\n        const { proxy } = getCurrentInstance()\n        \n        // 响应式数据\n        const data = reactive({})\n        const current = ref(1)\n        const cover = ref(null)\n        const size = ref(10)\n        const totalCount = ref(0)\n        const dialogOperation = ref(false) // 开关\n        const isOperation = ref(false) // 开关-标识新增或修改\n        const tableData = ref([])\n        const selectedRows = ref([])\n        const bookRssHistoryQueryDto = reactive({}) // 搜索条件\n        const options = ref([])\n        const bookshelfOptions = ref([])\n        const bookOrderHistorys = ref([])\n        const searchTime = ref([])\n\n        // 方法\n        const cannel = () => {\n            Object.assign(data, {});\n            dialogOperation.value = false;\n            isOperation.value = false;\n        }\n\n        // 借书操作\n        const addOperation = async () => {\n            try {\n                data.bookId = data.bookId;\n                const response = await proxy.$axios.post('/bookOrderHistory/save', data);\n                if (response.data.code === 200) {\n                    fetchFreshData();\n                    Object.assign(data, {});\n                    dialogOperation.value = false;\n                    proxy.$notify({\n                        title: '借书结果',\n                        message: '借书成功，请及时归还',\n                        type: 'success'\n                    });\n                } else {\n                    proxy.$notify({\n                        title: '借书结果',\n                        message: response.data.msg,\n                        type: 'error'\n                    });\n                }\n            } catch (error) {\n                proxy.$notify({\n                    title: '借书结果',\n                    message: error,\n                    type: 'error'\n                });\n            }\n        }\n\n        const parseLocation = (data) => {\n            return data.floor + '-' + data.area + '-' + data.frame;\n        }\n\n        const bookshelfConfig = (item) => {\n            return item.floor + \"-\" + item.area + \"-\" + item.frame;\n        }\n\n        const fetchBookshelf = () => {\n            proxy.$axios.post('bookshelf/query', {}).then(res => {\n                if (res.data.code === 200) {\n                    bookshelfOptions.value = res.data.data;\n                }\n            })\n        }\n\n        const fetchCategory = () => {\n            proxy.$axios.post('category/query', {}).then(res => {\n                if (res.data.code === 200) {\n                    options.value = res.data.data;\n                }\n            })\n        }\n\n        const resetQueryCondition = () => {\n            Object.assign(bookRssHistoryQueryDto, {});\n            fetchFreshData();\n        }\n\n        // 查询用户的预约记录\n        const getBookOrderHistory = () => {\n            proxy.$axios.post('bookOrderHistory/queryUser', {}).then(res => {\n                if (res.data.code === 200) {\n                    bookOrderHistorys.value = res.data.data;\n                }\n            })\n        }\n\n        // 信息新增\n        const returnOperation = async () => {\n            try {\n                // 发之前，组装数据\n                const bookOrderHsitory = {\n                    id: data.id,\n                    isReturn: true\n                }\n                const response = await proxy.$axios.put('bookRssHistory/update', bookOrderHsitory);\n                if (response.data.code === 200) {\n                    fetchFreshData();\n                    Object.assign(data, {});\n                    dialogOperation.value = false;\n                    proxy.$notify({\n                        title: '还书结果',\n                        message: '还书成功',\n                        type: 'success'\n                    });\n                } else {\n                    proxy.$notify({\n                        title: '还书结果',\n                        message: response.data.msg,\n                        type: 'error'\n                    });\n                }\n            } catch (error) {\n                proxy.$notify({\n                    title: '还书结果',\n                    message: error,\n                    type: 'error'\n                });\n            }\n        }\n\n        const closeDialog = () => {\n            dialogOperation.value = false;\n        }\n\n        const clearFormData = () => {\n            Object.assign(data, {});\n            cover.value = null;\n        }\n\n        const fetchFreshData = async () => {\n            try {\n                tableData.value = [];\n                // 请求参数\n                const params = {\n                    current: current.value,\n                    size: size.value,\n                    ...bookRssHistoryQueryDto\n                };\n                const response = await proxy.$axios.post('bookRssHistory/queryUser', params);\n                const { data: responseData } = response;\n                tableData.value = responseData.data;\n                totalCount.value = responseData.total;\n            } catch (error) {\n                console.error('借阅历史信息异常:', error);\n            }\n        }\n\n        const add = () => {\n            dialogOperation.value = true;\n        }\n\n        const handleFilter = () => {\n            current.value = 1;\n            fetchFreshData();\n        }\n\n        const handleFilterClear = () => {\n            handleFilter();\n        }\n\n        const handleSizeChange = (val) => {\n            size.value = val;\n            current.value = 1;\n            fetchFreshData();\n        }\n\n        const handleCurrentChange = (val) => {\n            current.value = val;\n            fetchFreshData();\n        }\n\n        const messagePush = (row) => {\n            Object.assign(data, { ...row });\n        }\n\n        const handleEdit = (row) => {\n            dialogOperation.value = true;\n            Object.assign(data, { ...row });\n        }\n\n        const handleDelete = (row) => {\n            batchDelete(row);\n        }\n\n        // 批量删除数据\n        const batchDelete = async (save) => {\n            const confirmed = await proxy.$swalConfirm({\n                title: '取消订阅？',\n                text: `操作不可回复，是否继续？`,\n                icon: 'warning',\n            });\n            if (confirmed) {\n                try {\n                    let ids = [save.id];\n                    const response = await proxy.$axios.post(`bookRssHistory/batchDelete`, ids);\n                    if (response.data.code === 200) {\n                        proxy.$notify({\n                            duration: 1000,\n                            title: '取消订阅操作',\n                            message: '取消订阅成功',\n                            type: 'success'\n                        });\n                        fetchFreshData();\n                    }\n                } catch (e) {\n                    proxy.$notify({\n                        duration: 3000,\n                        title: '取消订阅操作',\n                        message: e,\n                        type: 'error'\n                    });\n                    console.error(`取消订阅异常：`, e);\n                }\n            }\n        }\n\n        // 生命周期\n        onMounted(() => {\n            fetchFreshData();\n            fetchCategory();\n            fetchBookshelf();\n        })\n\n        return {\n            data,\n            current,\n            cover,\n            size,\n            totalCount,\n            dialogOperation,\n            isOperation,\n            tableData,\n            selectedRows,\n            bookRssHistoryQueryDto,\n            options,\n            bookshelfOptions,\n            bookOrderHistorys,\n            searchTime,\n            cannel,\n            addOperation,\n            parseLocation,\n            bookshelfConfig,\n            fetchBookshelf,\n            fetchCategory,\n            resetQueryCondition,\n            getBookOrderHistory,\n            returnOperation,\n            closeDialog,\n            clearFormData,\n            fetchFreshData,\n            add,\n            handleFilter,\n            handleFilterClear,\n            handleSizeChange,\n            handleCurrentChange,\n            messagePush,\n            handleEdit,\n            handleDelete,\n            batchDelete\n        }\n    }\n};\n</script>\n<style scoped lang=\"scss\">\n.book-rss-history-container {\n    width: 100%;\n    padding: 10px 20px 20px 20px;\n    box-sizing: border-box;\n}\n\n.word-search {\n    display: flex;\n    justify-content: center;\n    margin-bottom: 20px;\n\n    .item {\n        padding: 10px 20px;\n        width: 500px;\n        background-color: rgba(255, 255, 255, 0.8);\n        backdrop-filter: blur(10px);\n        border-radius: 40px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        box-sizing: border-box;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.06);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n        transition: all 0.3s ease;\n\n        &:hover, &:focus-within {\n            box-shadow: 0 6px 16px rgba(255, 87, 34, 0.12);\n            border-color: rgba(255, 87, 34, 0.2);\n        }\n\n        input {\n            flex: 1;\n            border: none;\n            background-color: transparent;\n            outline: none;\n            font-size: 16px;\n            color: #333;\n            margin: 0 15px;\n            height: 24px;\n        }\n\n        i {\n            font-size: 18px;\n            color: #ff5722;\n        }\n\n        .search-text {\n            display: inline-block;\n            padding: 6px 16px;\n            border-radius: 20px;\n            background-color: #ff5722;\n            color: white;\n            font-size: 14px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            text-align: center;\n            \n            &:hover {\n                background-color: #f4511e;\n                transform: translateY(-1px);\n            }\n        }\n    }\n}\n\n.book-rss-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin: 20px 0;\n}\n\n.book-rss-table {\n    width: 90%;\n    max-width: 1200px;\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.05);\n    background-color: rgba(255, 255, 255, 0.8);\n    backdrop-filter: blur(8px);\n}\n\n.save-book {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid rgba(240, 240, 240, 0.5);\n    transition: all 0.3s ease;\n    \n    &:last-child {\n        border-bottom: none;\n    }\n\n    div {\n        padding: 16px 20px;\n        flex: 1;\n        min-width: 120px;\n        color: #333;\n        font-size: 14px;\n    }\n\n    .title {\n        font-weight: 600;\n        color: #555;\n    }\n\n    .action-buttons {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-start;\n    }\n\n    .action-btn {\n        display: inline-block;\n        padding: 6px 16px;\n        border-radius: 20px;\n        font-size: 13px;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        \n        &.cancel {\n            background-color: rgba(103, 58, 183, 0.08);\n            color: #673ab7;\n            border: 1px solid rgba(103, 58, 183, 0.2);\n            \n            &:hover {\n                background-color: rgba(103, 58, 183, 0.12);\n                transform: translateY(-1px);\n                box-shadow: 0 2px 6px rgba(103, 58, 183, 0.15);\n            }\n        }\n    }\n}\n\n.save-book:hover {\n    background-color: rgba(249, 249, 249, 0.5);\n}\n\n.save-book.header {\n    background-color: rgba(245, 247, 250, 0.6);\n    border-bottom: 1px solid rgba(235, 238, 245, 0.5);\n    \n    &:hover {\n        background-color: rgba(245, 247, 250, 0.6);\n    }\n}\n\n.pager {\n    display: flex;\n    margin: 30px 0;\n    justify-content: center;\n    align-items: center;\n}\n\n/* 分页组件样式 */\n:deep(.el-pagination) {\n    padding: 15px 0;\n    text-align: center;\n}\n\n:deep(.el-pagination .btn-prev),\n:deep(.el-pagination .btn-next),\n:deep(.el-pager li) {\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    background-color: rgba(255, 255, 255, 0.7);\n}\n\n:deep(.el-pager li.active) {\n    background-color: #ff5722;\n    color: white;\n}\n</style>\n"],"mappings":";;EACSA,KAAK,EAAC;AAA4B;;;EAC9BA,KAAK,EAAC;;;EACFA,KAAK,EAAC;AAAM;;;EASTA,KAAK,EAAC;;;EACTA,KAAK,EAAC;AAAgB;;EAqBdA,KAAK,EAAC;AAAgB;;;;EAMlCA,KAAK,EAAC;;;;;;;;uBAvCfC,mBAAA,CA+CM,OA/CNC,UA+CM,GA9C6BC,MAAA,CAAAC,SAAS,CAACC,MAAM,U,cAA/CJ,mBAAA,CAMM,OANNK,UAMM,GALFC,mBAAA,CAIM,OAJNC,UAIM,GAHFC,YAAA,CAA6BC,kBAAA;sBAApB,MAAU,CAAVD,YAAA,CAAUE,iBAAA,E;;sBACnBJ,mBAAA,CAA8E;IAAvEK,IAAI,EAAC,MAAM;IAACC,WAAW,EAAC,MAAM;+DAAUV,MAAA,CAAAW,sBAAsB,CAACC,MAAM,GAAAC,MAAA;gCAA7Bb,MAAA,CAAAW,sBAAsB,CAACC,MAAM,E,GAC5ER,mBAAA,CAA2D;IAArDP,KAAK,EAAC,aAAa;IAAEiB,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEhB,MAAA,CAAAiB,cAAA,IAAAjB,MAAA,CAAAiB,cAAA,IAAAD,IAAA,CAAc;KAAE,IAAE,E,sCAG9ChB,MAAA,CAAAC,SAAS,CAACC,MAAM,U,cAA9BgB,YAAA,CAESC,iBAAA;IAAAC,GAAA;EAAA;sBADL,MAA0C,CAA1Cd,YAAA,CAA0Ce,mBAAA;MAAhCC,WAAW,EAAC;IAAQ,G;;uBAElCxB,mBAAA,CA2BM,OA3BNyB,UA2BM,GA1BFnB,mBAAA,CAyBM,OAzBNoB,UAyBM,G,sWAjBF1B,mBAAA,CAgBM2B,SAAA,QAAAC,WAAA,CAhByC1B,MAAA,CAAAC,SAAS,GAAzB0B,IAAI,EAAEC,KAAK;yBAA1C9B,mBAAA,CAgBM;MAhBDD,KAAK,EAAC,WAAW;MAAqCuB,GAAG,EAAEQ;QAC5DxB,mBAAA,CAEM,aAAAyB,gBAAA,CADCF,IAAI,CAACG,QAAQ,OAEpB1B,mBAAA,CAEM,aAAAyB,gBAAA,CADCF,IAAI,CAACI,MAAM,OAElB3B,mBAAA,CAEM,aAAAyB,gBAAA,CADCF,IAAI,CAACK,GAAG,OAEf5B,mBAAA,CAEM,aAAAyB,gBAAA,CADC7B,MAAA,CAAAiC,aAAa,CAACN,IAAI,QAEzBvB,mBAAA,CAEM,OAFN8B,UAEM,GADF9B,mBAAA,CAAuE;MAAjEP,KAAK,EAAC,mBAAmB;MAAEiB,OAAK,EAAAD,MAAA,IAAEb,MAAA,CAAAmC,YAAY,CAACR,IAAI;OAAG,MAAI,KAAAS,UAAA,E;kBAKvDpC,MAAA,CAAAC,SAAS,CAACC,MAAM,U,cAAzCJ,mBAAA,CAOM,OAPNuC,UAOM,GANFjC,mBAAA,CAKM,cAJFE,YAAA,CAGgBgC,wBAAA;IAHAC,YAAW,EAAEvC,MAAA,CAAAwC,gBAAgB;IAAGC,eAAc,EAAEzC,MAAA,CAAA0C,mBAAmB;IACvE,cAAY,EAAE1C,MAAA,CAAA2C,OAAO;gEAAP3C,MAAA,CAAA2C,OAAO,GAAA9B,MAAA;IAAG,WAAS,EAAEb,MAAA,CAAA4C,IAAI;IAAEC,MAAM,EAAC,0BAA0B;IACjFC,KAAK,EAAE9C,MAAA,CAAA+C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}