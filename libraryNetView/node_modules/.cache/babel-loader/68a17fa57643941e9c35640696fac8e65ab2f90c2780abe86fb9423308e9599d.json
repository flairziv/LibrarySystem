{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, resolveDynamicComponent as _resolveDynamicComponent, openBlock as _openBlock, createBlock as _createBlock, withCtx as _withCtx, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"nav-wrapper\"\n};\nconst _hoisted_2 = {\n  class: \"main\"\n};\nconst _hoisted_3 = {\n  class: \"page-header\"\n};\nconst _hoisted_4 = {\n  class: \"header-title\"\n};\nconst _hoisted_5 = {\n  class: \"header-actions\"\n};\nconst _hoisted_6 = {\n  class: \"content-section\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_UserNavigation = _resolveComponent(\"UserNavigation\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_EditPen = _resolveComponent(\"EditPen\");\n  const _component_el_tooltip = _resolveComponent(\"el-tooltip\");\n  const _component_router_view = _resolveComponent(\"router-view\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: _normalizeClass([\"menu-container\", {\n      'collapsed-menu': $setup.flag\n    }])\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_UserNavigation, {\n    routes: $setup.userRoutes,\n    \"current-route-name\": $setup.nowRoute.name,\n    \"user-info\": $setup.userInfo,\n    \"is-collapsed\": $setup.flag,\n    \"user-center-path\": $setup.selfPath,\n    onRouteClick: $setup.routerClick,\n    onToggleCollapse: $setup.toggleSidebar,\n    onLogout: $setup.loginOut\n  }, null, 8, [\"routes\", \"current-route-name\", \"user-info\", \"is-collapsed\", \"user-center-path\", \"onRouteClick\", \"onToggleCollapse\", \"onLogout\"])]), _createElementVNode(\"div\", {\n    class: _normalizeClass([\"main-wrapper\", {\n      'main-wrapper-expanded': $setup.flag\n    }])\n  }, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [$setup.nowRoute.icon ? (_openBlock(), _createBlock(_component_el_icon, {\n    key: 0\n  }, {\n    default: _withCtx(() => [(_openBlock(), _createBlock(_resolveDynamicComponent($setup.nowRoute.icon)))]),\n    _: 1\n  })) : _createCommentVNode(\"\", true), _createElementVNode(\"span\", null, _toDisplayString($setup.nowRoute.name || '首页'), 1)]), _createElementVNode(\"div\", _hoisted_5, [$setup.nowRoute.path === '/main' ? (_openBlock(), _createBlock(_component_el_tooltip, {\n    key: 0,\n    content: \"添加留言\",\n    placement: \"bottom\",\n    effect: \"light\"\n  }, {\n    default: _withCtx(() => [_createElementVNode(\"div\", {\n      class: \"action-btn\",\n      onClick: _cache[0] || (_cache[0] = $event => $setup.handleAction('add'))\n    }, [_createVNode(_component_el_icon, null, {\n      default: _withCtx(() => [_createVNode(_component_EditPen)]),\n      _: 1\n    })])]),\n    _: 1\n  })) : _createCommentVNode(\"\", true)])]), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_router_view, {\n    ref: \"currentView\"\n  }, null, 512)])])], 2)], 2);\n}","map":{"version":3,"names":["class","_createElementBlock","_normalizeClass","$setup","flag","_createElementVNode","_hoisted_1","_createVNode","_component_UserNavigation","routes","userRoutes","nowRoute","name","userInfo","selfPath","onRouteClick","routerClick","onToggleCollapse","toggleSidebar","onLogout","loginOut","_hoisted_2","_hoisted_3","_hoisted_4","icon","_createBlock","_component_el_icon","key","_resolveDynamicComponent","_toDisplayString","_hoisted_5","path","_component_el_tooltip","content","placement","effect","onClick","_cache","$event","handleAction","_component_EditPen","_hoisted_6","_component_router_view","ref"],"sources":["E:\\code\\IntelliJ_IDEAProjects\\LibrarySystem\\libraryNetView\\src\\views\\user\\Home.vue"],"sourcesContent":["<template>\n    <div class=\"menu-container\" :class=\"{'collapsed-menu': flag}\">\n        <div class=\"nav-wrapper\">\n        <UserNavigation \n            :routes=\"userRoutes\" \n            :current-route-name=\"nowRoute.name\" \n            :user-info=\"userInfo\" \n            :is-collapsed=\"flag\"\n            :user-center-path=\"selfPath\"\n            @route-click=\"routerClick\"\n            @toggle-collapse=\"toggleSidebar\"\n            @logout=\"loginOut\"\n        />\n        </div>\n        <div class=\"main-wrapper\" :class=\"{'main-wrapper-expanded': flag}\">\n            <div class=\"main\">\n            <div class=\"page-header\">\n                <div class=\"header-title\">\n                    <el-icon v-if=\"nowRoute.icon\">\n                        <component :is=\"nowRoute.icon\" />\n                    </el-icon>\n                    <span>{{ nowRoute.name || '首页' }}</span>\n                </div>\n                <div class=\"header-actions\">\n                    <template v-if=\"nowRoute.path === '/main'\">\n                        <el-tooltip content=\"添加留言\" placement=\"bottom\" effect=\"light\">\n                            <div class=\"action-btn\" @click=\"handleAction('add')\">\n                                <el-icon>\n                                    <EditPen />\n                                </el-icon>\n                            </div>\n                        </el-tooltip>\n                    </template>\n                </div>\n            </div>\n            <div class=\"content-section\">\n                <router-view ref=\"currentView\"></router-view>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport { ref, reactive, onMounted, watch, getCurrentInstance, nextTick } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport request from \"@/utils/request.js\";\nimport router from \"@/router/index\";\nimport { clearToken } from \"@/utils/storage\"\nimport UserNavigation from '@/components/UserNavigation.vue';\nimport { EditPen } from '@element-plus/icons-vue'\n\nexport default {\n    name: \"UserHome\",\n    components: {\n        UserNavigation,\n        EditPen\n    },\n    setup() {\n        const { proxy } = getCurrentInstance()\n        const vueRouter = useRouter()\n        const route = useRoute()\n        \n        // 响应式数据\n        const selfPath = reactive({ name: '个人中心', path: '/mySelf' })\n        const userRoutes = ref([\n            { path: \"/main\", name: '留言', icon: 'ChatDotSquare', show: true },\n            { path: \"/bookOperation\", name: '借阅', icon: 'Reading', show: true },\n            { path: \"/bookOrderHistory\", name: '历史', icon: 'Timer', show: true },\n            { path: \"/bookSave\", name: '收藏', icon: 'Collection', show: true },\n            { path: \"/bookRssHistory\", name: '订阅', icon: 'Connection', show: true },\n            { path: \"/rssNotification\", name: '通知', icon: 'Message', show: true },\n            { path: \"/userOperationLog\", name: '日志', icon: 'Notebook', show: true },\n            { path: \"/notice\", name: '公告', icon: 'Bell', show: true }\n        ])\n        const userInfo = reactive({\n            id: null,\n            url: '',\n            name: '',\n            role: null,\n            email: ''\n        })\n        const flag = ref(false)\n        const nowRoute = reactive({\n            name: '',\n            path: '',\n            icon: null\n        })\n        const currentView = ref(null)\n\n        // 方法\n        const handleAction = (action) => {\n            if (nowRoute.path === '/main' && action === 'add') {\n                if (currentView.value && currentView.value.postWord) {\n                    currentView.value.postWord();\n                }\n            }\n        }\n\n        const toggleSidebar = () => {\n            flag.value = !flag.value;\n            sessionStorage.setItem('flag', flag.value);\n        }\n\n        const routerClick = (route) => {\n            handleRouteSelect(route);\n        }\n\n        const loginOut = async () => {\n            const confirmed = await proxy.$swalConfirm({\n                title: '退出登录？',\n                text: '退出后需重新登录',\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonText: '确认',\n                cancelButtonText: '取消',\n                confirmButtonColor: '#ff5722',\n                cancelButtonColor: '#909399'\n            });\n            if (confirmed) {\n                proxy.$swal.fire({\n                    title: '退出登录成功',\n                    text: '1s 后返回登录页面',\n                    icon: 'success',\n                    showConfirmButton: false,\n                    timer: 1000,\n                });\n                setTimeout(() => {\n                    clearToken();\n                    vueRouter.push(\"/login\");\n                }, 1000)\n            }\n        }\n\n        const menuOperationHistory = () => {\n            flag.value = sessionStorage.getItem('flag') === 'true';\n        }\n\n        const handleRouteSelect = (routeItem) => {\n            if (nowRoute.name !== routeItem.name) {\n                Object.assign(nowRoute, routeItem);\n                vueRouter.push(routeItem.path);\n            }\n        }\n\n        const tokenCheckLoad = async () => {\n            try {\n                const res = await request.get('user/auth');\n                if (res.data.code === 400) {\n                    proxy.$message.error(res.data.msg);\n                    vueRouter.push('/login');\n                    return;\n                }\n                const { id, userAvatar: url, userName: name, userRole: role, userEmail: email } = res.data.data;\n                Object.assign(userInfo, { id, url, name, role, email });\n                sessionStorage.setItem('userInfo', JSON.stringify(userInfo));\n                sessionStorage.setItem('userId', userInfo.id);\n                \n                // 注释掉旧的路由API调用，使用静态配置\n                // const rolePath = role === 1 ? '/admin' : '/user';\n                // const targetMenu = router.options.routes.find(route => route.path === rolePath);\n                // if (targetMenu) {\n                //     userRoutes.value = targetMenu.children;\n                // }\n            } catch (error) {\n                console.error('获取用户认证信息时发生错误:', error);\n                proxy.$message.error('认证信息加载失败，请重试！');\n            }\n        }\n\n        const updateCurrentRoute = () => {\n            const currentPath = route.path;\n            const matchedRoute = userRoutes.value.find(routeItem => routeItem.path === currentPath);\n            if (matchedRoute) {\n                Object.assign(nowRoute, matchedRoute);\n                return true;\n            }\n            return false;\n        }\n\n        // 监听路由变化\n        watch(() => route.path, () => {\n            updateCurrentRoute();\n        })\n\n        // 生命周期\n        onMounted(() => {\n            tokenCheckLoad();\n            menuOperationHistory();\n            \n            if (!updateCurrentRoute() && userRoutes.value.length > 0) {\n                routerClick(userRoutes.value[0]);\n            }\n        })\n\n        return {\n            selfPath,\n            userRoutes,\n            userInfo,\n            flag,\n            nowRoute,\n            currentView,\n            handleAction,\n            toggleSidebar,\n            routerClick,\n            loginOut,\n            menuOperationHistory,\n            handleRouteSelect,\n            tokenCheckLoad,\n            updateCurrentRoute\n        }\n    }\n};\n</script>\n<style scoped lang=\"scss\">\n.menu-container {\n    display: flex;\n    height: 100vh;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n    background-color: #FFFFFF;\n    \n    &::after {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 228px; /* 与导航栏宽度相近的位置 */\n        height: 100%;\n        width: 2px;\n        background: linear-gradient(to bottom, \n            rgba(255, 123, 0, 0.03), \n            rgba(255, 123, 0, 0.1) 50%, \n            rgba(255, 123, 0, 0.03)\n        );\n        z-index: 999;\n        pointer-events: none;\n        transition: left 0.25s cubic-bezier(0.22, 1, 0.36, 1);\n        opacity: 0.8;\n    }\n    \n    &.collapsed-menu::after {\n        left: 118px; /* 当菜单收起时的位置 */\n    }\n}\n\n.nav-wrapper {\n    position: relative;\n    z-index: 1000;\n    height: 100%;\n    margin-right: 2px;\n}\n\n// 用更优雅的方式为UserNavigation组件添加样式\n:deep(.menu-side) {\n    // 移除覆盖背景的样式，让组件使用自己的渐变背景\n    // background: rgba(255, 255, 255, 0.9) !important;\n    backdrop-filter: blur(10px);\n    box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);\n    border-radius: 0 20px 20px 0;\n    border: none;\n    height: 100vh;\n}\n\n.main-wrapper {\n    flex-grow: 1;\n    height: 100vh;\n    position: relative;\n    transition: all 0.25s cubic-bezier(0.22, 1, 0.36, 1);\n    overflow: hidden;\n    background: #FFFFFF;\n    margin-left: 3px;\n}\n\n.main-wrapper-expanded {\n    margin-left: 0;\n}\n\n.main {\n    position: relative;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    box-sizing: border-box;\n    padding: 0;\n    background-image: linear-gradient(to top, #fad0c4 0%, #fad0c4 1%, #ffd1ff 100%);\n    background-attachment: fixed;\n    border-radius: 16px 0 0 16px;\n    box-shadow: -6px 0 15px rgba(0, 0, 0, 0.05);\n    border-left: 1px solid rgba(255, 123, 0, 0.15);\n    \n    &::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: \n            radial-gradient(circle at 20% 30%, rgba(84, 182, 229, 0.04) 0%, rgba(84, 182, 229, 0) 40%),\n            radial-gradient(circle at 80% 60%, rgba(255, 160, 100, 0.03) 0%, rgba(255, 160, 100, 0) 40%);\n        pointer-events: none;\n        z-index: 0;\n    }\n}\n    \n    .content-section {\n        flex-grow: 1;\n        padding: 20px;\n        box-sizing: border-box;\n        overflow-y: auto;\n        width: 100%;\n    position: relative;\n    z-index: 1;\n        \n        &::-webkit-scrollbar {\n            width: 4px;\n        }\n  \n        &::-webkit-scrollbar-track {\n            background: transparent;\n        }\n  \n        &::-webkit-scrollbar-thumb {\n        background-color: rgba(255, 123, 0, 0.12);\n            border-radius: 10px;\n        \n        &:hover {\n            background-color: rgba(255, 123, 0, 0.18);\n        }\n    }\n}\n\n.page-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 20px 20px 15px 20px;\n    background-color: transparent;\n    position: relative;\n    z-index: 1;\n    height: 60px;\n    box-sizing: border-box;\n    \n    .header-title {\n        display: flex;\n        align-items: center;\n        font-size: 18px;\n        font-weight: 600;\n        color: #333;\n        \n        i {\n            margin-right: 10px;\n            font-size: 20px;\n            color: #ff5722;\n        }\n    }\n    \n    .header-actions {\n        display: flex;\n        gap: 10px;\n        \n        .action-btn {\n            width: 36px;\n            height: 36px;\n            border-radius: 10px;\n            background-color: white;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n            transition: all 0.3s ease;\n            \n            i {\n                font-size: 16px;\n                color: #606266;\n            }\n            \n            &:hover {\n                background-color: rgba(255, 87, 34, 0.08);\n                transform: translateY(-2px);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n                \n                i {\n                    color: #ff5722;\n                }\n            }\n        }\n    }\n}\n</style>\n"],"mappings":";;EAEaA,KAAK,EAAC;AAAa;;EAafA,KAAK,EAAC;AAAM;;EACZA,KAAK,EAAC;AAAa;;EACfA,KAAK,EAAC;AAAc;;EAMpBA,KAAK,EAAC;AAAgB;;EAY1BA,KAAK,EAAC;AAAiB;;;;;;;uBAlCpCC,mBAAA,CAuCM;IAvCDD,KAAK,EAAAE,eAAA,EAAC,gBAAgB;MAAA,kBAA4BC,MAAA,CAAAC;IAAI;MACvDC,mBAAA,CAWM,OAXNC,UAWM,GAVNC,YAAA,CASEC,yBAAA;IARGC,MAAM,EAAEN,MAAA,CAAAO,UAAU;IAClB,oBAAkB,EAAEP,MAAA,CAAAQ,QAAQ,CAACC,IAAI;IACjC,WAAS,EAAET,MAAA,CAAAU,QAAQ;IACnB,cAAY,EAAEV,MAAA,CAAAC,IAAI;IAClB,kBAAgB,EAAED,MAAA,CAAAW,QAAQ;IAC1BC,YAAW,EAAEZ,MAAA,CAAAa,WAAW;IACxBC,gBAAe,EAAEd,MAAA,CAAAe,aAAa;IAC9BC,QAAM,EAAEhB,MAAA,CAAAiB;oJAGbf,mBAAA,CAyBM;IAzBDL,KAAK,EAAAE,eAAA,EAAC,cAAc;MAAA,yBAAmCC,MAAA,CAAAC;IAAI;MAC5DC,mBAAA,CAuBM,OAvBNgB,UAuBM,GAtBNhB,mBAAA,CAkBM,OAlBNiB,UAkBM,GAjBFjB,mBAAA,CAKM,OALNkB,UAKM,GAJapB,MAAA,CAAAQ,QAAQ,CAACa,IAAI,I,cAA5BC,YAAA,CAEUC,kBAAA;IAAAC,GAAA;EAAA;sBADN,MAAiC,E,cAAjCF,YAAA,CAAiCG,wBAAA,CAAjBzB,MAAA,CAAAQ,QAAQ,CAACa,IAAI,I;;uCAEjCnB,mBAAA,CAAwC,cAAAwB,gBAAA,CAA/B1B,MAAA,CAAAQ,QAAQ,CAACC,IAAI,c,GAE1BP,mBAAA,CAUM,OAVNyB,UAUM,GATc3B,MAAA,CAAAQ,QAAQ,CAACoB,IAAI,gB,cACzBN,YAAA,CAMaO,qBAAA;;IANDC,OAAO,EAAC,MAAM;IAACC,SAAS,EAAC,QAAQ;IAACC,MAAM,EAAC;;sBACjD,MAIM,CAJN9B,mBAAA,CAIM;MAJDL,KAAK,EAAC,YAAY;MAAEoC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEnC,MAAA,CAAAoC,YAAY;QACxChC,YAAA,CAEUmB,kBAAA;wBADN,MAAW,CAAXnB,YAAA,CAAWiC,kBAAA,E;;;;2CAOnCnC,mBAAA,CAEU,OAFVoC,UAEU,GADNlC,YAAA,CAA6CmC,sBAAA;IAAhCC,GAAG,EAAC;EAAa,c","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}