"use strict";(self["webpackChunkprosonal_health_web"]=self["webpackChunkprosonal_health_web"]||[]).push([[239],{4239:function(e,a,l){l.r(a),l.d(a,{default:function(){return j}});var s=l(641),t=l(3751),o=l(33);const n={class:"word-search"},r={class:"item"},c={class:"category-container"},i=["onClick"],d={class:"content-section"},u={key:1,class:"card-list"},p={class:"message-icon"},k={class:"message-main"},g={class:"card-header"},v={class:"user-info"},m={class:"user-name"},h={class:"message-actions"},b={class:"message-time"},C={key:0,class:"reply-tag"},L={class:"card-content"},y={key:0,class:"card-reply"},f={class:"reply-header"},F={class:"reply-time"},_={class:"reply-content"},S={key:0,class:"pager"},P={class:"dialog-container"},R={class:"dialog-header"},w={class:"header-icon"},z={class:"input-section"},K={class:"visibility-section"},I={class:"section-title"},x={class:"option-cards"},X={class:"card-icon"},D={class:"card-radio"},E={key:0,class:"radio-inner"},V={class:"card-icon"},Q={class:"card-radio"},U={key:0,class:"radio-inner"},q={class:"action-buttons"};function W(e,a,l,W,$,A){const O=(0,s.g2)("Search"),T=(0,s.g2)("el-icon"),N=(0,s.g2)("el-empty"),j=(0,s.g2)("ChatDotSquare"),J=(0,s.g2)("el-avatar"),B=(0,s.g2)("Delete"),G=(0,s.g2)("el-button"),H=(0,s.g2)("el-popconfirm"),M=(0,s.g2)("Avatar"),Y=(0,s.g2)("el-pagination"),Z=(0,s.g2)("EditPen"),ee=(0,s.g2)("el-input"),ae=(0,s.g2)("el-form-item"),le=(0,s.g2)("View"),se=(0,s.g2)("Unlock"),te=(0,s.g2)("Lock"),oe=(0,s.g2)("el-form"),ne=(0,s.g2)("Close"),re=(0,s.g2)("Promotion"),ce=(0,s.g2)("el-dialog"),ie=(0,s.g2)("el-row");return(0,s.uX)(),(0,s.Wv)(ie,{class:"main-proposal-container"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",n,[(0,s.Lk)("div",r,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(O)]),_:1}),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"搜索用户留言","onUpdate:modelValue":a[0]||(a[0]=e=>W.readerProposalQueryDto.content=e)},null,512),[[t.Jo,W.readerProposalQueryDto.content]]),(0,s.Lk)("span",{class:"search-text",onClick:a[1]||(a[1]=(...e)=>W.fetchReaderProposal&&W.fetchReaderProposal(...e))},"搜索")])]),(0,s.Lk)("div",c,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.tags,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{class:(0,o.C4)(["category",{"active-category":W.tagSelected===e}]),onClick:a=>W.condition(e),key:a},(0,o.v_)(e),11,i))),128))]),(0,s.Lk)("div",d,[0===W.proposals.length?((0,s.uX)(),(0,s.Wv)(N,{key:0,description:"暂无留言","image-size":200})):((0,s.uX)(),(0,s.CE)("div",u,[a[10]||(a[10]=(0,s.Lk)("div",{class:"list-title"},[(0,s.Lk)("span",{class:"title-text"},"用户留言"),(0,s.Lk)("div",{class:"line-decoration"})],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.proposals,(e,l)=>((0,s.uX)(),(0,s.CE)("div",{key:l,class:(0,o.C4)(["message-card",W.getCardClass(l,e)])},[(0,s.Lk)("div",p,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(j)]),_:1})]),(0,s.Lk)("div",k,[(0,s.Lk)("div",g,[(0,s.Lk)("div",v,[(0,s.bF)(J,{src:e.userAvatar,size:36},null,8,["src"]),(0,s.Lk)("div",m,(0,o.v_)(e.userName),1)]),(0,s.Lk)("div",h,[(0,s.Lk)("span",b,(0,o.v_)(e.createTime),1),null!==e.replyTime?((0,s.uX)(),(0,s.CE)("span",C,"已回复")):(0,s.Q3)("",!0),W.myContent(e)?((0,s.uX)(),(0,s.Wv)(H,{key:1,title:"确定删除这条留言吗？",onConfirm:a=>W.confirmDel(e)},{reference:(0,s.k6)(()=>[(0,s.bF)(G,{type:"danger",size:"small",circle:""},{icon:(0,s.k6)(()=>[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(B)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",L,(0,o.v_)(e.content),1),null!==e.replyTime?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("div",f,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(M)]),_:1}),a[9]||(a[9]=(0,s.Lk)("span",null,"管理员回复",-1)),(0,s.Lk)("span",F,(0,o.v_)(e.replyTime),1)]),(0,s.Lk)("div",_,(0,o.v_)(e.replyContent),1)])):(0,s.Q3)("",!0)])],2))),128))]))]),0!==W.proposals.length?((0,s.uX)(),(0,s.CE)("div",S,[(0,s.bF)(Y,{onSizeChange:W.handleSizeChange,onCurrentChange:W.handleCurrentChange,"current-page":W.current,"onUpdate:currentPage":a[2]||(a[2]=e=>W.current=e),"page-size":W.size,layout:"total, prev, pager, next",total:W.totalCount},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):(0,s.Q3)("",!0),(0,s.bF)(ce,{modelValue:W.dialogWordOperation,"onUpdate:modelValue":a[8]||(a[8]=e=>W.dialogWordOperation=e),"show-close":!1,width:"520px","custom-class":"modern-dialog","append-to-body":!0},{default:(0,s.k6)(()=>[(0,s.Lk)("div",P,[(0,s.Lk)("div",R,[(0,s.Lk)("div",w,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(Z)]),_:1})]),a[11]||(a[11]=(0,s.Lk)("div",{class:"header-content"},[(0,s.Lk)("h3",{class:"header-title"},"发表留言"),(0,s.Lk)("p",{class:"header-subtitle"},"分享您的想法和建议")],-1))]),(0,s.bF)(oe,{model:W.proposal,ref:"proposalForm",class:"proposal-form"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",z,[(0,s.bF)(ae,{prop:"content",rules:[{required:!0,message:"请输入留言内容",trigger:"blur"},{max:250,message:"留言内容不能超过250字",trigger:"blur"}]},{default:(0,s.k6)(()=>[(0,s.bF)(ee,{type:"textarea",rows:4,placeholder:"请输入留言内容，250字以内",modelValue:W.proposal.content,"onUpdate:modelValue":a[3]||(a[3]=e=>W.proposal.content=e),resize:"none",maxlength:"250","show-word-limit":"",class:"content-textarea"},null,8,["modelValue"])]),_:1})]),(0,s.Lk)("div",K,[(0,s.Lk)("div",I,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(le)]),_:1}),a[12]||(a[12]=(0,s.Lk)("span",null,"留言可见性",-1))]),(0,s.Lk)("div",x,[(0,s.Lk)("div",{class:(0,o.C4)(["option-card",{active:"公开"===W.publishItemSelected}]),onClick:a[4]||(a[4]=e=>W.publishItemSelected="公开")},[(0,s.Lk)("div",X,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(se)]),_:1})]),a[13]||(a[13]=(0,s.Lk)("div",{class:"card-content"},[(0,s.Lk)("h4",null,"公开"),(0,s.Lk)("p",null,"所有用户可见")],-1)),(0,s.Lk)("div",D,["公开"===W.publishItemSelected?((0,s.uX)(),(0,s.CE)("div",E)):(0,s.Q3)("",!0)])],2),(0,s.Lk)("div",{class:(0,o.C4)(["option-card",{active:"不公开"===W.publishItemSelected}]),onClick:a[5]||(a[5]=e=>W.publishItemSelected="不公开")},[(0,s.Lk)("div",V,[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(te)]),_:1})]),a[14]||(a[14]=(0,s.Lk)("div",{class:"card-content"},[(0,s.Lk)("h4",null,"不公开"),(0,s.Lk)("p",null,"仅管理员可见")],-1)),(0,s.Lk)("div",Q,["不公开"===W.publishItemSelected?((0,s.uX)(),(0,s.CE)("div",U)):(0,s.Q3)("",!0)])],2)])])]),_:1},8,["model"]),(0,s.Lk)("div",q,[(0,s.Lk)("button",{class:"cancel-button",onClick:a[6]||(a[6]=(...e)=>W.cannel&&W.cannel(...e))},[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(ne)]),_:1}),a[15]||(a[15]=(0,s.Lk)("span",null,"取消",-1))]),(0,s.Lk)("button",{class:"submit-button",onClick:a[7]||(a[7]=(...e)=>W.postProposal&&W.postProposal(...e))},[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(re)]),_:1}),a[16]||(a[16]=(0,s.Lk)("span",null,"发表留言",-1))])])])]),_:1},8,["modelValue"])]),_:1})}var $=l(953),A=l(8548),O={components:{ChatDotSquare:A.ChatDotSquare,Delete:A.Delete,Avatar:A.Avatar,View:A.View,Unlock:A.Unlock,Lock:A.Lock,Close:A.Close,Promotion:A.Promotion,Search:A.Search},setup(){const{proxy:e}=(0,s.nI)(),a=(0,$.Kh)({}),l=(0,$.KR)(["全部","已回复","未回复","我的发布"]),t=(0,$.KR)("全部"),o=(0,$.Kh)({current:1,size:5}),n=(0,$.KR)([]),r=(0,$.KR)(0),c=(0,$.KR)(5),i=(0,$.KR)(1),d=(0,$.KR)(!1),u=(0,$.KR)("公开"),p=(0,$.KR)(!1),k=(0,$.KR)(["blue-card","green-card","orange-card","purple-card","cyan-card"]),g=(0,$.KR)(null),v=(e,a)=>k.value[e%k.value.length],m=()=>{g.value.validate(l=>{l&&(a.isPublish="公开"===u.value,e.$axios.post("/readerProposal/save",a).then(a=>{const{data:l}=a;200===l.code&&(e.$notify({duration:1e3,title:"留言",message:"留言发表成功",type:"success"}),_("我的发布"),h())}).catch(a=>{e.$notify({title:"留言发表",message:a.message||"发表失败",type:"error"}),console.log("留言发表异常：",a)}))})},h=()=>{p.value=!1,Object.assign(a,{}),g.value&&g.value.resetFields()},b=()=>{p.value=!0},C=e=>{const a=sessionStorage.getItem("userId");return e.userId===Number(a)},L=a=>{const l=[a.id];e.$axios.post("/readerProposal/batchDelete",l).then(a=>{const{data:l}=a;200===l.code&&(e.$notify({duration:1e3,title:"留言删除",message:"留言删除成功",type:"success"}),S())}).catch(a=>{e.$notify({title:"留言删除",message:a.message||"删除失败",type:"error"}),console.log("删除留言异常：",a)})},y=e=>{c.value=e,o.size=e,S()},f=e=>{i.value=e,o.current=e,S()},F=e=>{t.value=e,_(e)},_=e=>{switch(e){case"全部":d.value=!1,o.isReply=null;break;case"已回复":d.value=!1,o.isReply=!0;break;case"未回复":d.value=!1,o.isReply=!1;break;case"我的发布":d.value=!0;break}S()},S=()=>{o.size=c.value,o.current=i.value;const a=d.value?"/readerProposal/queryUser":"/readerProposal/query";e.$axios.post(a,o).then(e=>{const{data:a}=e;200===a.code&&(n.value=a.data,r.value=a.total)}).catch(e=>{console.log("查询用户留言异常：",e)})};return(0,s.sV)(()=>{S()}),{proposal:a,tags:l,tagSelected:t,readerProposalQueryDto:o,proposals:n,totalCount:r,size:c,current:i,queryUser:d,publishItemSelected:u,dialogWordOperation:p,cardColors:k,proposalForm:g,getCardClass:v,postProposal:m,cannel:h,postWord:b,myContent:C,confirmDel:L,handleSizeChange:y,handleCurrentChange:f,condition:F,paramCondition:_,fetchReaderProposal:S}}},T=l(6262);const N=(0,T.A)(O,[["render",W],["__scopeId","data-v-50430bce"]]);var j=N}}]);
//# sourceMappingURL=239.e3225646.js.map