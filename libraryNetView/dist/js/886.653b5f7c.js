"use strict";(self["webpackChunkprosonal_health_web"]=self["webpackChunkprosonal_health_web"]||[]).push([[886],{6886:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var o=a(641),l=a(3751),n=a(33);const s={class:"history-container"},r={class:"word-search"},c={class:"item"},i={class:"books-grid"},u={class:"book-cover"},d=["src"],k={class:"book-info"},b=["title"],h={class:"book-quantity"},p={class:"book-dates"},g={class:"date-item"},v={class:"date-item"},C={class:"book-actions"},y=["onClick"],f=["onClick"],L={key:0,class:"pager"};function R(e,t,a,R,m,_){const D=(0,o.g2)("Search"),K=(0,o.g2)("el-icon"),F=(0,o.g2)("el-empty"),w=(0,o.g2)("el-row"),x=(0,o.g2)("Clock"),z=(0,o.g2)("Calendar"),S=(0,o.g2)("RefreshLeft"),X=(0,o.g2)("Delete"),I=(0,o.g2)("el-col"),O=(0,o.g2)("el-pagination");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",r,[(0,o.Lk)("div",c,[(0,o.bF)(K,null,{default:(0,o.k6)(()=>[(0,o.bF)(D)]),_:1}),(0,o.bo)((0,o.Lk)("input",{type:"text",placeholder:"搜索书籍ID","onUpdate:modelValue":t[0]||(t[0]=e=>R.bookQueryDto.bookId=e)},null,512),[[l.Jo,R.bookQueryDto.bookId]]),(0,o.Lk)("span",{class:"search-text",onClick:t[1]||(t[1]=(...e)=>R.fetchFreshData&&R.fetchFreshData(...e))},"搜索")])]),(0,o.Lk)("div",i,[0===R.tableData.length?((0,o.uX)(),(0,o.Wv)(w,{key:0},{default:(0,o.k6)(()=>[(0,o.bF)(F,{description:"暂无书籍借阅历史",class:"empty-data"})]),_:1})):((0,o.uX)(),(0,o.Wv)(w,{key:1},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(R.tableData,(e,a)=>((0,o.uX)(),(0,o.Wv)(I,{key:a,sm:12,md:8,lg:6,xl:6},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:(0,n.C4)(["book-card",{returned:e.isReturn}])},[(0,o.Lk)("div",u,[(0,o.Lk)("img",{src:e.bookCover,alt:""},null,8,d),(0,o.Lk)("div",{class:(0,n.C4)(["book-status",{"return-pending":!e.isReturn}])},(0,n.v_)(e.isReturn?"已归还":"待归还"),3)]),(0,o.Lk)("div",k,[(0,o.Lk)("h3",{class:"book-title",title:e.bookName},(0,n.v_)(e.bookName),9,b),(0,o.Lk)("div",h,[t[3]||(t[3]=(0,o.eW)(" 借阅数量: ",-1)),(0,o.Lk)("span",null,(0,n.v_)(e.deadlineNum),1),t[4]||(t[4]=(0,o.eW)(" 本 ",-1))]),(0,o.Lk)("div",p,[(0,o.Lk)("div",g,[(0,o.bF)(K,null,{default:(0,o.k6)(()=>[(0,o.bF)(x)]),_:1}),(0,o.Lk)("span",null,"借阅: "+(0,n.v_)(e.createTime),1)]),(0,o.Lk)("div",v,[(0,o.bF)(K,null,{default:(0,o.k6)(()=>[(0,o.bF)(z)]),_:1}),(0,o.Lk)("span",null,"归还: "+(0,n.v_)(e.returnTime),1)])]),(0,o.Lk)("div",C,[e.isReturn?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"action-btn delete-btn",onClick:t=>R.handleDelete(e)},[(0,o.bF)(K,null,{default:(0,o.k6)(()=>[(0,o.bF)(X)]),_:1}),t[6]||(t[6]=(0,o.Lk)("span",null,"删除",-1))],8,f)):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"action-btn return-btn",onClick:t=>R.handleReturn(e)},[(0,o.bF)(K,null,{default:(0,o.k6)(()=>[(0,o.bF)(S)]),_:1}),t[5]||(t[5]=(0,o.Lk)("span",null,"归还",-1))],8,y))])])],2)]),_:2},1024))),128))]),_:1}))]),0!==R.tableData.length?((0,o.uX)(),(0,o.CE)("div",L,[(0,o.bF)(O,{onSizeChange:R.handleSizeChange,onCurrentChange:R.handleCurrentChange,"current-page":R.current,"onUpdate:currentPage":t[2]||(t[2]=e=>R.current=e),"page-size":R.size,layout:"total, prev, pager, next",total:R.totalCount},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):(0,o.Q3)("",!0)])}var m=a(953),_=a(8548),D={components:{Search:_.Search,Clock:_.Clock,Calendar:_.Calendar,RefreshLeft:_.RefreshLeft,Delete:_.Delete},setup(){const{proxy:e}=(0,o.nI)(),t=(0,m.KR)(1),a=(0,m.Kh)({}),l=(0,m.KR)(1),n=(0,m.KR)(null),s=(0,m.KR)(8),r=(0,m.KR)(0),c=(0,m.KR)(!1),i=(0,m.KR)(!1),u=(0,m.KR)([]),d=(0,m.KR)([]),k=(0,m.Kh)({}),b=(0,m.KR)([]),h=(0,m.KR)([]),p=(0,m.KR)(null),g=(0,m.KR)([]),v=(0,m.KR)([]),C=t=>{const a={id:t.id};e.$axios.put("/bookOrderHistory/update",a).then(t=>{200===t.data.code&&(e.$notify({duration:1e3,title:"还书操作",message:"还书成功",type:"success"}),f())}).catch(e=>{console.log("还书异常：",e)})},y=async t=>{const a=await e.$swalConfirm({title:"删除书籍预约历史数据",text:"删除后不可恢复，是否继续？",icon:"warning"});if(a)try{let a=[t.id];const o=await e.$axios.post("/bookOrderHistory/batchDelete",a),{data:l}=o;200===l.code&&(e.$notify({duration:1e3,title:"删除操作",message:"删除成功",type:"success"}),f())}catch(o){e.$notify({duration:2e3,title:"删除失败",message:o,type:"error"}),console.error("书籍预约信息删除异常：",o)}},f=async()=>{try{const t={current:l.value,size:s.value,...k},a=await e.$axios.post("/bookOrderHistory/queryUser",t),{data:o}=a;u.value=o.data,r.value=o.total}catch(t){console.error("查询书籍借阅历史信息异常:",t)}},L=e=>{s.value=e,l.value=1,f()},R=e=>{l.value=e,f()},_=e=>{y(e)};return(0,o.sV)(()=>{f()}),{deadlineNum:t,data:a,current:l,cover:n,size:s,totalCount:r,dialogOperation:c,isOperation:i,tableData:u,selectedRows:d,bookQueryDto:k,options:b,bookshelfOptions:h,categoryItemSelected:p,categoryList:g,bookOrderHistorys:v,handleReturn:C,batchDelete:y,fetchFreshData:f,handleSizeChange:L,handleCurrentChange:R,handleDelete:_}}},K=a(6262);const F=(0,K.A)(D,[["render",R],["__scopeId","data-v-5e563e58"]]);var w=F}}]);
//# sourceMappingURL=886.653b5f7c.js.map